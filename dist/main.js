/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){t=function(){return n};var n={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},l=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,a=Object.create(o.prototype),l=new O(r||[]);return i(a,"_invoke",{value:B(e,n,l)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=f;var p={};function m(){}function d(){}function v(){}var g={};u(g,l,(function(){return this}));var y=Object.getPrototypeOf,w=y&&y(y(E([])));w&&w!==r&&o.call(w,l)&&(g=w);var b=v.prototype=m.prototype=Object.create(g);function A(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function k(t,n){function r(i,a,l,c){var s=h(t[i],t,a);if("throw"!==s.type){var u=s.arg,f=u.value;return f&&"object"==e(f)&&o.call(f,"__await")?n.resolve(f.__await).then((function(e){r("next",e,l,c)}),(function(e){r("throw",e,l,c)})):n.resolve(f).then((function(e){u.value=e,l(u)}),(function(e){return r("throw",e,l,c)}))}c(s.arg)}var a;i(this,"_invoke",{value:function(e,t){function o(){return new n((function(n,o){r(e,t,n,o)}))}return a=a?a.then(o,o):o()}})}function B(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var l=L(a,n);if(l){if(l===p)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=h(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function L(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,L(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var o=h(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,p;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function E(e){if(e){var t=e[l];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:S}}function S(){return{value:void 0,done:!0}}return d.prototype=v,i(b,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:d,configurable:!0}),d.displayName=u(v,s,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},n.awrap=function(e){return{__await:e}},A(k.prototype),u(k.prototype,c,(function(){return this})),n.AsyncIterator=k,n.async=function(e,t,r,o,i){void 0===i&&(i=Promise);var a=new k(f(e,t,r,o),i);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},A(b),u(b,s,"Generator"),u(b,l,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=E,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(N),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var l=o.call(i,"catchLoc"),c=o.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),N(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;N(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},n}function n(e,t,n,r,o,i,a){try{var l=e[i](a),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,o)}function r(){var e;return e=t().mark((function e(){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){var n=document.getElementById("renderCanvas");BABYLON.Effect.ShadersStore.flashFragmentShader="\n    varying vec2 vUV;\n    uniform sampler2D textureSampler;\n    uniform float flashIntensity;\n    uniform vec3 color;\n\n    void main(void) {\n        vec4 baseColor = texture2D(textureSampler, vUV);\n        gl_FragColor = mix(baseColor, vec4(color, 1.0), flashIntensity);\n    }\n";var r=new BABYLON.Engine(n,!0,{disableWebGL2Support:!1});window.engine=r;var o=function(){BABYLON.Animation.AllowMatricesInterpolation=!0;var e=new BABYLON.Scene(r),t={skyboxSize:100,groundSize:100,skyboxColor:new BABYLON.Color3(.25,.5,1),groundColor:new BABYLON.Color3(.05,.05,.15),cameraExposure:1,enableGroundShadow:!1,rootPosition:new BABYLON.Vector3(0,-2,0),toneMappingEnabled:!0},o=e.createDefaultEnvironment(t);e.environmentIntensity=2;var i=new BABYLON.Texture("./assets/correlatedMSBRDF_RGBD.png",e,!0,!0,BABYLON.Texture.BILINEAR_SAMPLINGMODE),a=new BABYLON.CubeTexture("./assets/skybox.dds",e);a.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,o.skybox.material.reflectionTexture=a,i.isRGBD=!0,i.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,i.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,e.environmentBRDFTexture=i;var l=new BABYLON.ArcRotateCamera("camera",BABYLON.Tools.ToRadians(90),BABYLON.Tools.ToRadians(65),10,BABYLON.Vector3.Zero(),e);l.lowerRadiusLimit=10,l.upperRadiusLimit=40,l.lowerBetaLimit=.1,l.upperBetaLimit=Math.PI/2.2,l.panningDistanceLimit=0,l.attachControl(n,!0);var c=new BABYLON.DirectionalLight("light",new BABYLON.Vector3(0,-15,-5),e);return c.position=new BABYLON.Vector3(0,6,0),c.intensity=5,e}();window.scene=o,e([r,o])})));case 1:case"end":return e.stop()}}),e)})),r=function(){var t=this,r=arguments;return new Promise((function(o,i){var a=e.apply(t,r);function l(e){n(a,o,i,l,c,"next",e)}function c(e){n(a,o,i,l,c,"throw",e)}l(void 0)}))},r.apply(this,arguments)}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(){i=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},l=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function f(e,t,n,o){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),l=new O(o||[]);return r(a,"_invoke",{value:B(e,n,l)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=f;var p={};function m(){}function d(){}function v(){}var g={};u(g,l,(function(){return this}));var y=Object.getPrototypeOf,w=y&&y(y(E([])));w&&w!==t&&n.call(w,l)&&(g=w);var b=v.prototype=m.prototype=Object.create(g);function A(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function i(r,a,l,c){var s=h(e[r],e,a);if("throw"!==s.type){var u=s.arg,f=u.value;return f&&"object"==o(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){i("next",e,l,c)}),(function(e){i("throw",e,l,c)})):t.resolve(f).then((function(e){u.value=e,l(u)}),(function(e){return i("throw",e,l,c)}))}c(s.arg)}var a;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return a=a?a.then(r,r):r()}})}function B(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var l=L(a,n);if(l){if(l===p)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=h(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function L(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,L(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var o=h(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,p;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function E(e){if(e){var t=e[l];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return d.prototype=v,r(b,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:d,configurable:!0}),d.displayName=u(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},A(k.prototype),u(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new k(f(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},A(b),u(b,s,"Generator"),u(b,l,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=E,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(N),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),N(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;N(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},e}function a(e,t,n,r,o,i,a){try{var l=e[i](a),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,o)}function l(){return c.apply(this,arguments)}function c(){var e;return e=i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){var n=new BABYLON.AssetsManager(scene),r=new BABYLON.AssetContainer(scene),o=new BABYLON.Vector3(.006,.006,.006),i=n.addMeshTask("Sword","Sword","./assets/","weapons.babylon"),a=n.addMeshTask("Scepter","Scepter","./assets/","weapons.babylon"),l=n.addMeshTask("Shield","Shield","./assets/","weapons.babylon"),c=n.addMeshTask("Staff","Staff","./assets/","weapons.babylon"),s=n.addMeshTask("Spear","Spear","./assets/","weapons.babylon"),u=n.addMeshTask("Board","","./assets/","chessboard.babylon"),f=n.addMeshTask("Pawn","","./assets/","pawn.babylon"),h=n.addMeshTask("Bishop","","./assets/","bishop.babylon"),p=n.addMeshTask("Knight","","./assets/","knight.babylon"),m=n.addMeshTask("Rook","","./assets/","rook.babylon"),d=n.addMeshTask("Queen","","./assets/","queen.babylon"),v=n.addMeshTask("King","","./assets/","king.babylon");i.onSuccess=function(e){var t=e.loadedMeshes[0];t.parent=null,t.name="Sword",r.meshes.push(t)},a.onSuccess=function(e){var t=e.loadedMeshes[0];t.parent=null,t.name="Scepter",r.meshes.push(t)},l.onSuccess=function(e){var t=e.loadedMeshes[0];t.parent=null,t.name="Shield",r.meshes.push(t)},c.onSuccess=function(e){var t=e.loadedMeshes[0];t.parent=null,t.name="Staff",r.meshes.push(t)},s.onSuccess=function(e){var t=e.loadedMeshes[0];t.parent=null,t.name="Spear",r.meshes.push(t)},u.onSuccess=function(e){var t=e.loadedMeshes[0],n=e.loadedMeshes[1];t.parent=null,t.name="BoardDecoration",n.parent=null,n.name="Board",r.meshes.push(t),r.meshes.push(n)},f.onSuccess=function(e){var t=e.loadedSkeletons[0],n=e.loadedMeshes[0];n.scaling=o,t.scaling=o,r.meshes.push(n,t)},p.onSuccess=function(e){var t=e.loadedSkeletons[0],n=e.loadedMeshes[0];n.scaling=o,t.scaling=o,r.meshes.push(n)},h.onSuccess=function(e){var t=e.loadedSkeletons[0],n=e.loadedMeshes[0];n.scaling=o,t.scaling=o,r.meshes.push(n)},m.onSuccess=function(e){var t=e.loadedSkeletons[0],n=e.loadedMeshes[0];n.scaling=o,t.scaling=o,r.meshes.push(n)},d.onSuccess=function(e){var t=e.loadedSkeletons[0],n=e.loadedMeshes[0];n.scaling=o,t.scaling=o,r.meshes.push(n)},v.onSuccess=function(e){var t=e.loadedSkeletons[0],n=e.loadedMeshes[0];n.scaling=o,t.scaling=o,r.meshes.push(n)},n.onFinish=function(t){r.removeAllFromScene(),e(r)},n.load()})));case 1:case"end":return e.stop()}}),e)})),c=function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function l(e){a(i,r,o,l,c,"next",e)}function c(e){a(i,r,o,l,c,"throw",e)}l(void 0)}))},c.apply(this,arguments)}const s="Result";class u{constructor(e=""){this.clear();const t=e.match(/\[([^\]]+)]/g);if(t&&t.length>0)for(let e=0;e<t.length;e++){let n=t[e].match(/\[(\w+)\s+"([^"]+)"/);n&&(this.tags[n[1]]=n[2])}}clear(){this.tags={}}render(){let e="";for(const t in this.tags)e+=`[${t} "${this.tags[t]}"]\n`;return e}}function f(e,t,n,r){this.message=e,this.expected=t,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,f)}function h(e,t){t=void 0!==t?t:{};var n,r,o,i,a={},l={pgn:sn},c=sn,s=function(e,t){var n=t||[];return n.unshift(e),n},u=function(e,t){var n=t||[];return n.unshift(e),n},h=function(){return[[]]},p=function(e){return e},m=function(e){return e},d=function(e,t,n,r,o,i,a,l){var c=l||[],s={turn:"w"};return s.moveNumber=t,s.notation=r,s.commentBefore=n,s.commentAfter=i,s.commentMove=e,s.variations=a||[],s.nag=o||null,c.unshift(s),c},v=function(e,t,n,r,o,i,a,l){var c=l||[],s={turn:"b"};return s.moveNumber=t,s.notation=r,s.commentBefore=n,s.commentAfter=i,s.variations=a||[],c.unshift(s),s.nag=o||null,c},g="1:0",y=rn("1:0",!1),w=function(){return["1:0"]},b="0:1",A=rn("0:1",!1),k=function(){return["0:1"]},B="1-0",L=rn("1-0",!1),x=function(){return["1-0"]},N="0-1",O=rn("0-1",!1),E=function(){return["0-1"]},S="1/2-1/2",C=rn("1/2-1/2",!1),T=function(){return["1/2-1/2"]},_="*",P=rn("*",!1),I=function(){return["*"]},R=/^[^}]/,M=on(["}"],!0,!1),Y=function(e){return e.join("").trim()},G="{",j=rn("{",!1),D="}",F=rn("}",!1),U=function(e,t,n){var r=t||[];return r.unshift(e),r},$=function(e,t){var n=t||[];return n.unshift(e),n},K="(",Q=rn("(",!1),V=")",q=rn(")",!1),z=".",H=rn(".",!1),W=function(e){return e},Z={type:"other",description:"integer"},J=/^[0-9]/,X=on([["0","9"]],!1,!1),ee=function(e){return parseInt(e.join(""),10)},te=" ",ne=rn(" ",!1),re=function(){return""},oe=function(e,t,n,r,o,i,a){var l={};return l.fig=e||null,l.disc=t||null,l.strike=n||null,l.col=r,l.row=o,l.check=a||null,l.promotion=i,l.notation=(e||"")+(t||"")+(n||"")+r+o+(i||"")+(a||""),l},ie=function(e,t,n,r,o,i,a,l){var c={};return c.fig=e||null,c.strike="x"==r?r:null,c.col=o,c.row=i,c.check=l||null,c.notation=(e&&"P"!==e?e:"")+t+n+("x"==r?r:"-")+o+i+(a||"")+(l||""),c.promotion=a,c},ae=function(e,t,n,r,o,i){var a={};return a.fig=e||null,a.strike=t||null,a.col=n,a.row=r,a.check=i||null,a.notation=(e||"")+(t||"")+n+r+(o||"")+(i||""),a.promotion=o,a},le="O-O-O",ce=rn("O-O-O",!1),se=function(e){var t={};return t.notation="O-O-O"+(e||""),t.check=e||null,t},ue="O-O",fe=rn("O-O",!1),he=function(e){var t={};return t.notation="O-O"+(e||""),t.check=e||null,t},pe="+-",me=rn("+-",!1),de="+",ve=rn("+",!1),ge=function(e){return e[1]},ye="$$$",we=rn("$$$",!1),be="#",Ae=rn("#",!1),ke="=",Be=rn("=",!1),Le=function(e){return"="+e},xe=function(e,t){var n=t||[];return n.unshift(e),n},Ne="$",Oe=rn("$",!1),Ee=function(e){return"$"+e},Se="!!",Ce=rn("!!",!1),Te=function(){return"$3"},_e="??",Pe=rn("??",!1),Ie=function(){return"$4"},Re="!?",Me=rn("!?",!1),Ye=function(){return"$5"},Ge="?!",je=rn("?!",!1),De=function(){return"$6"},Fe="!",Ue=rn("!",!1),$e=function(){return"$1"},Ke="?",Qe=rn("?",!1),Ve=function(){return"$2"},qe="‼",ze=rn("‼",!1),He="⁇",We=rn("⁇",!1),Ze="⁉",Je=rn("⁉",!1),Xe="⁈",et=rn("⁈",!1),tt="□",nt=rn("□",!1),rt=function(){return"$7"},ot=function(){return"$10"},it="∞",at=rn("∞",!1),lt=function(){return"$13"},ct="⩲",st=rn("⩲",!1),ut=function(){return"$14"},ft="⩱",ht=rn("⩱",!1),pt=function(){return"$15"},mt="±",dt=rn("±",!1),vt=function(){return"$16"},gt="∓",yt=rn("∓",!1),wt=function(){return"$17"},bt=function(){return"$18"},At="-+",kt=rn("-+",!1),Bt=function(){return"$19"},Lt="⨀",xt=rn("⨀",!1),Nt=function(){return"$22"},Ot="⟳",Et=rn("⟳",!1),St=function(){return"$32"},Ct="→",Tt=rn("→",!1),_t=function(){return"$36"},Pt="↑",It=rn("↑",!1),Rt=function(){return"$40"},Mt="⇆",Yt=rn("⇆",!1),Gt=function(){return"$132"},jt="D",Dt=rn("D",!1),Ft=function(){return"$220"},Ut=/^[RNBQKP]/,$t=on(["R","N","B","Q","K","P"],!1,!1),Kt=/^[a-h]/,Qt=on([["a","h"]],!1,!1),Vt=/^[1-8]/,qt=on([["1","8"]],!1,!1),zt="x",Ht=rn("x",!1),Wt="-",Zt=rn("-",!1),Jt=0,Xt=[{line:1,column:1}],en=0,tn=[],nn=0;if("startRule"in t){if(!(t.startRule in l))throw new Error("Can't start parsing from rule \""+t.startRule+'".');c=l[t.startRule]}function rn(e,t){return{type:"literal",text:e,ignoreCase:t}}function on(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function an(t){var n,r=Xt[t];if(r)return r;for(n=t-1;!Xt[n];)n--;for(r={line:(r=Xt[n]).line,column:r.column};n<t;)10===e.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return Xt[t]=r,r}function ln(e,t){var n=an(e),r=an(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:r.line,column:r.column}}}function cn(e){Jt<en||(Jt>en&&(en=Jt,tn=[]),tn.push(e))}function sn(){var e,t,n;return e=Jt,(t=function(){var e;return Jt,(e=fn())!==a&&(e=p(e)),e}())!==a?((n=hn())===a&&(n=null),n!==a?e=t=s(t,n):(Jt=e,e=a)):(Jt=e,e=a),e===a&&(e=Jt,(t=un())!==a?((n=fn())===a&&(n=null),n!==a?e=t=u(t,n):(Jt=e,e=a)):(Jt=e,e=a),e===a&&(e=Jt,(t=bn())===a&&(t=null),t!==a&&(t=h()),e=t)),e}function un(){var e;return Jt,(e=hn())!==a&&(e=m(e)),e}function fn(){var t,n,r,o,i,l,c,s,u,f,h,p,m,v,g,y;return t=Jt,(n=bn())===a&&(n=null),n!==a?((r=mn())===a&&(r=null),r!==a?((o=bn())===a&&(o=null),o!==a?(i=function(){var t,n,r;return t=Jt,(n=wn())!==a?(46===e.charCodeAt(Jt)?(r=z,Jt++):(r=a,0===nn&&cn(H)),r===a&&(r=null),r!==a?t=n=W(n):(Jt=t,t=a)):(Jt=t,t=a),t}(),i===a&&(i=null),i!==a?((l=bn())===a&&(l=null),l!==a?((c=mn())===a&&(c=null),c!==a?((s=bn())===a&&(s=null),s!==a&&(u=An())!==a?((f=bn())===a&&(f=null),f!==a?((h=Ln())===a&&(h=null),h!==a?((p=bn())===a&&(p=null),p!==a?((m=mn())===a&&(m=null),m!==a?((v=bn())===a&&(v=null),v!==a?((g=dn())===a&&(g=null),g!==a?((y=hn())===a&&(y=null),y!==a?t=n=d(r,i,c,u,h,m,g,y):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a),t===a&&(t=pn()),t}function hn(){var e,t,n,r,o,i,l,c,s,u,f,h,p,m,d,g;return e=Jt,(t=bn())===a&&(t=null),t!==a?((n=mn())===a&&(n=null),n!==a?((r=bn())===a&&(r=null),r!==a?((o=Nn())===a&&(o=null),o!==a?((i=bn())===a&&(i=null),i!==a?((l=mn())===a&&(l=null),l!==a?((c=bn())===a&&(c=null),c!==a&&(s=An())!==a?((u=bn())===a&&(u=null),u!==a?((f=Ln())===a&&(f=null),f!==a?((h=bn())===a&&(h=null),h!==a?((p=mn())===a&&(p=null),p!==a?((m=bn())===a&&(m=null),m!==a?((d=vn())===a&&(d=null),d!==a?((g=fn())===a&&(g=null),g!==a?e=t=v(n,o,l,s,f,p,d,g):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a),e===a&&(e=pn()),e}function pn(){var t,n;return t=Jt,e.substr(Jt,3)===g?(n=g,Jt+=3):(n=a,0===nn&&cn(y)),n!==a&&(n=w()),(t=n)===a&&(t=Jt,e.substr(Jt,3)===b?(n=b,Jt+=3):(n=a,0===nn&&cn(A)),n!==a&&(n=k()),(t=n)===a&&(t=Jt,e.substr(Jt,3)===B?(n=B,Jt+=3):(n=a,0===nn&&cn(L)),n!==a&&(n=x()),(t=n)===a&&(t=Jt,e.substr(Jt,3)===N?(n=N,Jt+=3):(n=a,0===nn&&cn(O)),n!==a&&(n=E()),(t=n)===a&&(t=Jt,e.substr(Jt,7)===S?(n=S,Jt+=7):(n=a,0===nn&&cn(C)),n!==a&&(n=T()),(t=n)===a&&(t=Jt,42===e.charCodeAt(Jt)?(n=_,Jt++):(n=a,0===nn&&cn(P)),n!==a&&(n=I()),t=n))))),t}function mn(){var t,n,r,o;if(t=Jt,n=function(){var t;return 123===e.charCodeAt(Jt)?(t=G,Jt++):(t=a,0===nn&&cn(j)),t}(),n!==a){for(r=[],R.test(e.charAt(Jt))?(o=e.charAt(Jt),Jt++):(o=a,0===nn&&cn(M));o!==a;)r.push(o),R.test(e.charAt(Jt))?(o=e.charAt(Jt),Jt++):(o=a,0===nn&&cn(M));r!==a?(o=function(){var t;return 125===e.charCodeAt(Jt)?(t=D,Jt++):(t=a,0===nn&&cn(F)),t}(),o!==a?t=n=Y(r):(Jt=t,t=a)):(Jt=t,t=a)}else Jt=t,t=a;return t}function dn(){var e,t,n,r,o,i;return e=Jt,gn()!==a&&(t=fn())!==a&&yn()!==a?((n=bn())===a&&(n=null),n!==a?((r=dn())===a&&(r=null),r!==a?((o=bn())===a&&(o=null),o!==a?((i=Nn())===a&&(i=null),i!==a?e=U(t,r,i):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a),e}function vn(){var e,t,n,r;return e=Jt,gn()!==a&&(t=un())!==a&&yn()!==a?((n=bn())===a&&(n=null),n!==a?((r=vn())===a&&(r=null),r!==a?e=$(t,r):(Jt=e,e=a)):(Jt=e,e=a)):(Jt=e,e=a),e}function gn(){var t;return 40===e.charCodeAt(Jt)?(t=K,Jt++):(t=a,0===nn&&cn(Q)),t}function yn(){var t;return 41===e.charCodeAt(Jt)?(t=V,Jt++):(t=a,0===nn&&cn(q)),t}function wn(){var t,n,r;if(nn++,t=Jt,n=[],J.test(e.charAt(Jt))?(r=e.charAt(Jt),Jt++):(r=a,0===nn&&cn(X)),r!==a)for(;r!==a;)n.push(r),J.test(e.charAt(Jt))?(r=e.charAt(Jt),Jt++):(r=a,0===nn&&cn(X));else n=a;return n!==a&&(n=ee(n)),nn--,(t=n)===a&&(n=a,0===nn&&cn(Z)),t}function bn(){var t,n;if(Jt,t=[],32===e.charCodeAt(Jt)?(n=te,Jt++):(n=a,0===nn&&cn(ne)),n!==a)for(;n!==a;)t.push(n),32===e.charCodeAt(Jt)?(n=te,Jt++):(n=a,0===nn&&cn(ne));else t=a;return t!==a&&(t=re()),t}function An(){var t,n,r,o,i,l,c,s,u;return t=Jt,(n=On())===a&&(n=null),n!==a?(r=Jt,nn++,o=function(){var e,t,n,r,o;return e=Jt,(t=xn())!==a?((n=Cn())===a&&(n=null),n!==a&&(r=En())!==a&&(o=Sn())!==a?e=t=[t,n,r,o]:(Jt=e,e=a)):(Jt=e,e=a),e}(),nn--,o!==a?(Jt=r,r=void 0):r=a,r!==a&&(o=xn())!==a?((i=Cn())===a&&(i=null),i!==a&&(l=En())!==a&&(c=Sn())!==a?((s=Bn())===a&&(s=null),s!==a?((u=kn())===a&&(u=null),u!==a?t=n=oe(n,o,i,l,c,s,u):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a),t===a&&(t=Jt,(n=On())===a&&(n=null),n!==a&&(r=En())!==a&&(o=Sn())!==a?(i=function(){var t;return 120===e.charCodeAt(Jt)?(t=zt,Jt++):(t=a,0===nn&&cn(Ht)),t===a&&(45===e.charCodeAt(Jt)?(t=Wt,Jt++):(t=a,0===nn&&cn(Zt))),t}(),i===a&&(i=null),i!==a&&(l=En())!==a&&(c=Sn())!==a?((s=Bn())===a&&(s=null),s!==a?((u=kn())===a&&(u=null),u!==a?t=n=ie(n,r,o,i,l,c,s,u):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a),t===a&&(t=Jt,(n=On())===a&&(n=null),n!==a?((r=Cn())===a&&(r=null),r!==a&&(o=En())!==a&&(i=Sn())!==a?((l=Bn())===a&&(l=null),l!==a?((c=kn())===a&&(c=null),c!==a?t=n=ae(n,r,o,i,l,c):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a),t===a&&(t=Jt,e.substr(Jt,5)===le?(n=le,Jt+=5):(n=a,0===nn&&cn(ce)),n!==a?((r=kn())===a&&(r=null),r!==a?t=n=se(r):(Jt=t,t=a)):(Jt=t,t=a),t===a&&(t=Jt,e.substr(Jt,3)===ue?(n=ue,Jt+=3):(n=a,0===nn&&cn(fe)),n!==a?((r=kn())===a&&(r=null),r!==a?t=n=he(r):(Jt=t,t=a)):(Jt=t,t=a))))),t}function kn(){var t,n,r,o;return t=Jt,n=Jt,r=Jt,nn++,e.substr(Jt,2)===pe?(o=pe,Jt+=2):(o=a,0===nn&&cn(me)),nn--,o===a?r=void 0:(Jt=r,r=a),r!==a?(43===e.charCodeAt(Jt)?(o=de,Jt++):(o=a,0===nn&&cn(ve)),o!==a?n=r=[r,o]:(Jt=n,n=a)):(Jt=n,n=a),n!==a&&(n=ge(n)),(t=n)===a&&(t=Jt,n=Jt,r=Jt,nn++,e.substr(Jt,3)===ye?(o=ye,Jt+=3):(o=a,0===nn&&cn(we)),nn--,o===a?r=void 0:(Jt=r,r=a),r!==a?(35===e.charCodeAt(Jt)?(o=be,Jt++):(o=a,0===nn&&cn(Ae)),o!==a?n=r=[r,o]:(Jt=n,n=a)):(Jt=n,n=a),n!==a&&(n=ge(n)),t=n),t}function Bn(){var t,n,r;return t=Jt,61===e.charCodeAt(Jt)?(n=ke,Jt++):(n=a,0===nn&&cn(Be)),n!==a&&(r=On())!==a?t=n=Le(r):(Jt=t,t=a),t}function Ln(){var t,n,r,o;return t=Jt,n=function(){var t,n,r;return t=Jt,36===e.charCodeAt(Jt)?(n=Ne,Jt++):(n=a,0===nn&&cn(Oe)),n!==a&&(r=wn())!==a?t=n=Ee(r):(Jt=t,t=a),t===a&&(t=Jt,e.substr(Jt,2)===Se?(n=Se,Jt+=2):(n=a,0===nn&&cn(Ce)),n!==a&&(n=Te()),(t=n)===a&&(t=Jt,e.substr(Jt,2)===_e?(n=_e,Jt+=2):(n=a,0===nn&&cn(Pe)),n!==a&&(n=Ie()),(t=n)===a&&(t=Jt,e.substr(Jt,2)===Re?(n=Re,Jt+=2):(n=a,0===nn&&cn(Me)),n!==a&&(n=Ye()),(t=n)===a&&(t=Jt,e.substr(Jt,2)===Ge?(n=Ge,Jt+=2):(n=a,0===nn&&cn(je)),n!==a&&(n=De()),(t=n)===a&&(t=Jt,33===e.charCodeAt(Jt)?(n=Fe,Jt++):(n=a,0===nn&&cn(Ue)),n!==a&&(n=$e()),(t=n)===a&&(t=Jt,63===e.charCodeAt(Jt)?(n=Ke,Jt++):(n=a,0===nn&&cn(Qe)),n!==a&&(n=Ve()),(t=n)===a&&(t=Jt,8252===e.charCodeAt(Jt)?(n=qe,Jt++):(n=a,0===nn&&cn(ze)),n!==a&&(n=Te()),(t=n)===a&&(t=Jt,8263===e.charCodeAt(Jt)?(n=He,Jt++):(n=a,0===nn&&cn(We)),n!==a&&(n=Ie()),(t=n)===a&&(t=Jt,8265===e.charCodeAt(Jt)?(n=Ze,Jt++):(n=a,0===nn&&cn(Je)),n!==a&&(n=Ye()),(t=n)===a&&(t=Jt,8264===e.charCodeAt(Jt)?(n=Xe,Jt++):(n=a,0===nn&&cn(et)),n!==a&&(n=De()),(t=n)===a&&(t=Jt,9633===e.charCodeAt(Jt)?(n=tt,Jt++):(n=a,0===nn&&cn(nt)),n!==a&&(n=rt()),(t=n)===a&&(t=Jt,61===e.charCodeAt(Jt)?(n=ke,Jt++):(n=a,0===nn&&cn(Be)),n!==a&&(n=ot()),(t=n)===a&&(t=Jt,8734===e.charCodeAt(Jt)?(n=it,Jt++):(n=a,0===nn&&cn(at)),n!==a&&(n=lt()),(t=n)===a&&(t=Jt,10866===e.charCodeAt(Jt)?(n=ct,Jt++):(n=a,0===nn&&cn(st)),n!==a&&(n=ut()),(t=n)===a&&(t=Jt,10865===e.charCodeAt(Jt)?(n=ft,Jt++):(n=a,0===nn&&cn(ht)),n!==a&&(n=pt()),(t=n)===a&&(t=Jt,177===e.charCodeAt(Jt)?(n=mt,Jt++):(n=a,0===nn&&cn(dt)),n!==a&&(n=vt()),(t=n)===a&&(t=Jt,8723===e.charCodeAt(Jt)?(n=gt,Jt++):(n=a,0===nn&&cn(yt)),n!==a&&(n=wt()),(t=n)===a&&(t=Jt,e.substr(Jt,2)===pe?(n=pe,Jt+=2):(n=a,0===nn&&cn(me)),n!==a&&(n=bt()),(t=n)===a&&(t=Jt,e.substr(Jt,2)===At?(n=At,Jt+=2):(n=a,0===nn&&cn(kt)),n!==a&&(n=Bt()),(t=n)===a&&(t=Jt,10752===e.charCodeAt(Jt)?(n=Lt,Jt++):(n=a,0===nn&&cn(xt)),n!==a&&(n=Nt()),(t=n)===a&&(t=Jt,10227===e.charCodeAt(Jt)?(n=Ot,Jt++):(n=a,0===nn&&cn(Et)),n!==a&&(n=St()),(t=n)===a&&(t=Jt,8594===e.charCodeAt(Jt)?(n=Ct,Jt++):(n=a,0===nn&&cn(Tt)),n!==a&&(n=_t()),(t=n)===a&&(t=Jt,8593===e.charCodeAt(Jt)?(n=Pt,Jt++):(n=a,0===nn&&cn(It)),n!==a&&(n=Rt()),(t=n)===a&&(t=Jt,8646===e.charCodeAt(Jt)?(n=Mt,Jt++):(n=a,0===nn&&cn(Yt)),n!==a&&(n=Gt()),(t=n)===a&&(t=Jt,68===e.charCodeAt(Jt)?(n=jt,Jt++):(n=a,0===nn&&cn(Dt)),n!==a&&(n=Ft()),t=n))))))))))))))))))))))))),t}(),n!==a?((r=bn())===a&&(r=null),r!==a?((o=Ln())===a&&(o=null),o!==a?t=n=xe(n,o):(Jt=t,t=a)):(Jt=t,t=a)):(Jt=t,t=a),t}function xn(){var e;return(e=En())===a&&(e=Sn()),e}function Nn(){var t,n,r,o;if(t=Jt,(n=wn())!==a){if(r=[],46===e.charCodeAt(Jt)?(o=z,Jt++):(o=a,0===nn&&cn(H)),o!==a)for(;o!==a;)r.push(o),46===e.charCodeAt(Jt)?(o=z,Jt++):(o=a,0===nn&&cn(H));else r=a;r!==a?t=n=W(n):(Jt=t,t=a)}else Jt=t,t=a;return t}function On(){var t;return Ut.test(e.charAt(Jt))?(t=e.charAt(Jt),Jt++):(t=a,0===nn&&cn($t)),t}function En(){var t;return Kt.test(e.charAt(Jt))?(t=e.charAt(Jt),Jt++):(t=a,0===nn&&cn(Qt)),t}function Sn(){var t;return Vt.test(e.charAt(Jt))?(t=e.charAt(Jt),Jt++):(t=a,0===nn&&cn(qt)),t}function Cn(){var t;return 120===e.charCodeAt(Jt)?(t=zt,Jt++):(t=a,0===nn&&cn(Ht)),t}if((n=c())!==a&&Jt===e.length)return n;throw n!==a&&Jt<e.length&&cn({type:"end"}),r=tn,o=en<e.length?e.charAt(en):null,i=en<e.length?ln(en,en+1):ln(en,en),new f(f.buildMessage(r,o),r,o,i)}!function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(f,Error),f.buildMessage=function(e,t){var n={literal:function(e){return'"'+o(e.text)+'"'},class:function(e){var t,n="";for(t=0;t<e.parts.length;t++)n+=e.parts[t]instanceof Array?i(e.parts[t][0])+"-"+i(e.parts[t][1]):i(e.parts[t]);return"["+(e.inverted?"^":"")+n+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function o(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}return"Expected "+function(e){var t,r,o,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=(o=e[t],n[o.type](o));if(i.sort(),i.length>0){for(t=1,r=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+function(e){return e?'"'+o(e)+'"':"end of input"}(t)+" found."};class p{static parse(e,t){return h(e,t)}}const m="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",d=["1-0","0-1","1/2-1/2","*"],v={b:[16,32,17,15],w:[-16,-32,-17,-15]},g={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},y=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],w=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],b={p:0,n:1,b:2,r:3,q:4,k:5},A={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},k={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},B={w:[{square:k.a1,flag:A.QSIDE_CASTLE},{square:k.h1,flag:A.KSIDE_CASTLE}],b:[{square:k.a8,flag:A.QSIDE_CASTLE},{square:k.h8,flag:A.KSIDE_CASTLE}]};function L(e){var t=e.charAt(0);if(t>="a"&&t<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return R}return"o"===(t=t.toLowerCase())?Y:t}function x(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function N(e){return e>>4}function O(e){return 15&e}function E(e){var t=O(e),n=N(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function S(e){return e===P?_:P}function C(e){var t=e instanceof Array?[]:{};for(var n in e)t[n]="object"==typeof n?C(e[n]):e[n];return t}function T(e){return e.replace(/^\s+|\s+$/g,"")}const _="b",P="w",I=-1,R="p",M="b",Y="k",G=(function(){for(var e=[],t=k.a8;t<=k.h1;t++)136&t?t+=7:e.push(E(t))}(),{NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"}),j=function(e){var t=new Array(128),n={w:I,b:I},r=P,o={w:0,b:0},i=I,a=0,l=1,c=[],s={},u={};function f(e){void 0===e&&(e=!1),t=new Array(128),n={w:I,b:I},r=P,o={w:0,b:0},i=I,a=0,l=1,c=[],e||(s={}),u={},$(F())}function h(){for(var e=[],t={},n=function(e){e in u&&(t[e]=u[e])};c.length>0;)e.push(re());for(n(F());e.length>0;)ne(e.pop()),n(F());u=t}function p(){j(m)}function j(e,t){void 0===t&&(t=!1);var n=e.split(/\s+/),c=n[0],s=0;if(!D(e).valid)return!1;f(t);for(var u=0;u<c.length;u++){var h=c.charAt(u);if("/"===h)s+=8;else if(-1!=="0123456789".indexOf(h))s+=parseInt(h,10);else{var p=h<"a"?P:_;Q({type:h.toLowerCase(),color:p},E(s)),s++}}return r=n[1],n[2].indexOf("K")>-1&&(o.w|=A.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(o.w|=A.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(o.b|=A.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(o.b|=A.QSIDE_CASTLE),i="-"===n[3]?I:k[n[3]],a=parseInt(n[4],10),l=parseInt(n[5],10),$(F()),!0}function D(e){var t=e.split(/\s+/);if(6!==t.length)return{valid:!1,error_number:1,error:"FEN string must contain six space-delimited fields."};if(isNaN(parseInt(t[5]))||parseInt(t[5],10)<=0)return{valid:!1,error_number:2,error:"6th field (move number) must be a positive integer."};if(isNaN(parseInt(t[4]))||parseInt(t[4],10)<0)return{valid:!1,error_number:3,error:"5th field (half move counter) must be a non-negative integer."};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{valid:!1,error_number:4,error:"4th field (en-passant square) is invalid."};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(t[2]))return{valid:!1,error_number:5,error:"3rd field (castling availability) is invalid."};if(!/^(w|b)$/.test(t[1]))return{valid:!1,error_number:6,error:"2nd field (side to move) is invalid."};var n=t[0].split("/");if(8!==n.length)return{valid:!1,error_number:7,error:"1st field (piece positions) does not contain 8 '/'-delimited rows."};for(var r=0;r<n.length;r++){for(var o=0,i=!1,a=0;a<n[r].length;a++)if(isNaN(n[r][a])){if(!/^[prnbqkPRNBQK]$/.test(n[r][a]))return{valid:!1,error_number:9,error:"1st field (piece positions) is invalid [invalid piece]."};o+=1,i=!1}else{if(i)return{valid:!1,error_number:8,error:"1st field (piece positions) is invalid [consecutive numbers]."};o+=parseInt(n[r][a],10),i=!0}if(8!==o)return{valid:!1,error_number:10,error:"1st field (piece positions) is invalid [row too large]."}}return"3"==t[3][1]&&"w"==t[1]||"6"==t[3][1]&&"b"==t[1]?{valid:!1,error_number:11,error:"Illegal en-passant square"}:{valid:!0,error_number:0,error:"No errors."}}function F(){for(var e=0,n="",c=k.a8;c<=k.h1;c++){if(null==t[c])e++;else{e>0&&(n+=e,e=0);var s=t[c].color,u=t[c].type;n+=s===P?u.toUpperCase():u.toLowerCase()}c+1&136&&(e>0&&(n+=e),c!==k.h1&&(n+="/"),e=0,c+=8)}var f="";o[P]&A.KSIDE_CASTLE&&(f+="K"),o[P]&A.QSIDE_CASTLE&&(f+="Q"),o[_]&A.KSIDE_CASTLE&&(f+="k"),o[_]&A.QSIDE_CASTLE&&(f+="q"),f=f||"-";var h=i===I?"-":E(i);return[n,r,f,h,a,l].join(" ")}function U(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(s[e[t]]=e[t+1]);return s}function $(e){c.length>0||(e!==m?(s.SetUp="1",s.FEN=e):(delete s.SetUp,delete s.FEN))}function K(e){var n=t[k[e]];return n?{type:n.type,color:n.color}:null}function Q(e,r){if(!("type"in e)||!("color"in e))return!1;if(-1==="pnbrqkPNBRQK".indexOf(e.type.toLowerCase()))return!1;if(!(r in k))return!1;var o=k[r];return(e.type!=Y||n[e.color]==I||n[e.color]==o)&&(t[o]={type:e.type,color:e.color},e.type===Y&&(n[e.color]=o),$(F()),!0)}function V(e,t,n,o,i){var a={color:r,from:t,to:n,flags:o,piece:e[t].type};return i&&(a.flags|=A.PROMOTION,a.promotion=i),e[n]?a.captured=e[n].type:o&A.EP_CAPTURE&&(a.captured=R),a}function q(e){function a(e,t,n,r,o){if(e[n].type!==R||0!==N(r)&&7!==N(r))t.push(V(e,n,r,o));else for(var i=["q","r",M,"n"],a=0,l=i.length;a<l;a++)t.push(V(e,n,r,o,i[a]))}var l=[],c=r,s=S(c),u={b:1,w:6},f=k.a8,h=k.h1,p=!1,m=void 0===e||!("legal"in e)||e.legal,d=void 0===e||!("piece"in e)||"string"!=typeof e.piece||e.piece.toLowerCase();if(void 0!==e&&"square"in e){if(!(e.square in k))return[];f=h=k[e.square],p=!0}for(var y=f;y<=h;y++)if(136&y)y+=7;else{var w=t[y];if(null!=w&&w.color===c)if(w.type!==R||!0!==d&&d!==R){if(!0===d||d===w.type)for(var b=0,B=g[w.type].length;b<B;b++){var L=g[w.type][b];for(x=y;!(136&(x+=L));){if(null!=t[x]){if(t[x].color===c)break;a(t,l,y,x,A.CAPTURE);break}if(a(t,l,y,x,A.NORMAL),"n"===w.type||"k"===w.type)break}}}else{var x=y+v[c][0];if(null==t[x]){a(t,l,y,x,A.NORMAL);x=y+v[c][1];u[c]===N(y)&&null==t[x]&&a(t,l,y,x,A.BIG_PAWN)}for(b=2;b<4;b++)136&(x=y+v[c][b])||(null!=t[x]&&t[x].color===s?a(t,l,y,x,A.CAPTURE):x===i&&a(t,l,y,i,A.EP_CAPTURE))}}if(!(!0!==d&&d!==Y||p&&h!==n[c])){if(o[c]&A.KSIDE_CASTLE){var O=(E=n[c])+2;null!=t[E+1]||null!=t[O]||H(s,n[c])||H(s,E+1)||H(s,O)||a(t,l,n[c],O,A.KSIDE_CASTLE)}var E;if(o[c]&A.QSIDE_CASTLE)O=(E=n[c])-2,null!=t[E-1]||null!=t[E-2]||null!=t[E-3]||H(s,n[c])||H(s,E-1)||H(s,O)||a(t,l,n[c],O,A.QSIDE_CASTLE)}if(!m)return l;var C=[];for(y=0,B=l.length;y<B;y++)ne(l[y]),W(c)||C.push(l[y]),re();return C}function z(e,t){var n="";if(e.flags&A.KSIDE_CASTLE)n="O-O";else if(e.flags&A.QSIDE_CASTLE)n="O-O-O";else{if(e.piece!==R){var r=function(e,t){for(var n=e.from,r=e.to,o=e.piece,i=0,a=0,l=0,c=0,s=t.length;c<s;c++){var u=t[c].from,f=t[c].to;o===t[c].piece&&n!==u&&r===f&&(i++,N(n)===N(u)&&a++,O(n)===O(u)&&l++)}return i>0?a>0&&l>0?E(n):l>0?E(n).charAt(1):E(n).charAt(0):""}(e,t);n+=e.piece.toUpperCase()+r}e.flags&(A.CAPTURE|A.EP_CAPTURE)&&(e.piece===R&&(n+=E(e.from)[0]),n+="x"),n+=E(e.to),e.flags&A.PROMOTION&&(n+="="+e.promotion.toUpperCase())}return ne(e),Z()&&(J()?n+="#":n+="+"),re(),n}function H(e,n){for(var r=k.a8;r<=k.h1;r++)if(136&r)r+=7;else if(null!=t[r]&&t[r].color===e){var o=t[r],i=r-n,a=i+119;if(y[a]&1<<b[o.type]){if(o.type===R){if(i>0){if(o.color===P)return!0}else if(o.color===_)return!0;continue}if("n"===o.type||"k"===o.type)return!0;for(var l=w[a],c=r+l,s=!1;c!==n;){if(null!=t[c]){s=!0;break}c+=l}if(!s)return!0}}return!1}function W(e){return H(S(e),n[e])}function Z(){return W(r)}function J(){return Z()&&0===q().length}function X(){return!Z()&&0===q().length}function ee(){for(var e={},n=[],r=0,o=0,i=k.a8;i<=k.h1;i++)if(o=(o+1)%2,136&i)i+=7;else{var a=t[i];a&&(e[a.type]=a.type in e?e[a.type]+1:1,a.type===M&&n.push(o),r++)}if(2===r)return!0;if(3===r&&(1===e[M]||1===e.n))return!0;if(r===e[M]+2){var l=0,c=n.length;for(i=0;i<c;i++)l+=n[i];if(0===l||l===c)return!0}return!1}function te(){for(var e=[],t={},n=!1;;){var r=re();if(!r)break;e.push(r)}for(;;){var o=F().split(" ").slice(0,4).join(" ");if(t[o]=o in t?t[o]+1:1,t[o]>=3&&(n=!0),!e.length)break;ne(e.pop())}return n}function ne(e){var s=r,u=S(s);if(function(e){c.push({move:e,kings:{b:n.b,w:n.w},turn:r,castling:{b:o.b,w:o.w},ep_square:i,half_moves:a,move_number:l})}(e),t[e.to]=t[e.from],t[e.from]=null,e.flags&A.EP_CAPTURE&&(r===_?t[e.to-16]=null:t[e.to+16]=null),e.flags&A.PROMOTION&&(t[e.to]={type:e.promotion,color:s}),t[e.to].type===Y){if(n[t[e.to].color]=e.to,e.flags&A.KSIDE_CASTLE){var f=e.to-1,h=e.to+1;t[f]=t[h],t[h]=null}else e.flags&A.QSIDE_CASTLE&&(f=e.to+1,h=e.to-2,t[f]=t[h],t[h]=null);o[s]=""}if(o[s])for(var p=0,m=B[s].length;p<m;p++)if(e.from===B[s][p].square&&o[s]&B[s][p].flag){o[s]^=B[s][p].flag;break}if(o[u])for(p=0,m=B[u].length;p<m;p++)if(e.to===B[u][p].square&&o[u]&B[u][p].flag){o[u]^=B[u][p].flag;break}i=e.flags&A.BIG_PAWN?"b"===r?e.to-16:e.to+16:I,e.piece===R||e.flags&(A.CAPTURE|A.EP_CAPTURE)?a=0:a++,r===_&&l++,r=S(r)}function re(){var e=c.pop();if(null==e)return null;var s=e.move;n=e.kings,r=e.turn,o=e.castling,i=e.ep_square,a=e.half_moves,l=e.move_number;var u,f,h=r,p=S(r);if(t[s.from]=t[s.to],t[s.from].type=s.piece,t[s.to]=null,s.flags&A.CAPTURE)t[s.to]={type:s.captured,color:p};else if(s.flags&A.EP_CAPTURE){var m;m=h===_?s.to-16:s.to+16,t[m]={type:R,color:p}}return s.flags&(A.KSIDE_CASTLE|A.QSIDE_CASTLE)&&(s.flags&A.KSIDE_CASTLE?(u=s.to+1,f=s.to-1):s.flags&A.QSIDE_CASTLE&&(u=s.to-2,f=s.to+1),t[u]=t[f],t[f]=null),s}function oe(e,t){for(var n=x(e),r=0;r<2;r++){if(1==r){if(!t)return null;var o=!1;if(s=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/)){var i=s[1],a=s[2],l=s[3],c=s[4];1==a.length&&(o=!0)}else{var s;(s=n.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/))&&(i=s[1],a=s[2],l=s[3],c=s[4],1==a.length&&(o=!0))}}for(var u=L(n),f=q({legal:!0,piece:i||u}),h=0,p=f.length;h<p;h++)switch(r){case 0:if(n===x(z(f[h],f)))return f[h];break;case 1:if(s){if(!(i&&i.toLowerCase()!=f[h].piece||k[a]!=f[h].from||k[l]!=f[h].to||c&&c.toLowerCase()!=f[h].promotion))return f[h];if(o){var m=E(f[h].from);if(!(i&&i.toLowerCase()!=f[h].piece||k[l]!=f[h].to||a!=m[0]&&a!=m[1]||c&&c.toLowerCase()!=f[h].promotion))return f[h]}}}}return null}function ie(e){var t=C(e);t.san=z(t,q({legal:!0})),t.to=E(t.to),t.from=E(t.from);var n="";for(var r in A)A[r]&t.flags&&(n+=G[r]);return t.flags=n,t}function ae(e){for(var t=q({legal:!1}),n=0,o=r,i=0,a=t.length;i<a;i++)ne(t[i]),W(o)||(e-1>0?n+=ae(e-1):n++),re();return n}return j(void 0===e?m:e),{load:function(e){return j(e)},reset:function(){return p()},moves:function(e){for(var t=q(e),n=[],r=0,o=t.length;r<o;r++)void 0!==e&&"verbose"in e&&e.verbose?n.push(ie(t[r])):n.push(z(t[r],q({legal:!0})));return n},in_check:function(){return Z()},in_checkmate:function(){return J()},in_stalemate:function(){return X()},in_draw:function(){return a>=100||X()||ee()||te()},insufficient_material:function(){return ee()},in_threefold_repetition:function(){return te()},game_over:function(){return a>=100||J()||X()||ee()||te()},validate_fen:function(e){return D(e)},fen:function(){return F()},board:function(){for(var e=[],n=[],r=k.a8;r<=k.h1;r++)null==t[r]?n.push(null):n.push({square:E(r),type:t[r].type,color:t[r].color}),r+1&136&&(e.push(n),n=[],r+=8);return e},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",n="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,r=[],o=!1;for(var i in s)r.push("["+i+' "'+s[i]+'"]'+t),o=!0;o&&c.length&&r.push(t);for(var a=function(e){var t=u[F()];return void 0!==t&&(e=`${e}${e.length>0?" ":""}{${t}}`),e},f=[];c.length>0;)f.push(re());var h=[],p="";for(0===f.length&&h.push(a(""));f.length>0;){p=a(p);var m=f.pop();if(c.length||"b"!==m.color)"w"===m.color&&(p.length&&h.push(p),p=l+".");else{const e=`${l}. ...`;p=p?`${p} ${e}`:e}p=p+" "+z(m,q({legal:!0})),ne(m)}if(p.length&&h.push(a(p)),void 0!==s.Result&&h.push(s.Result),0===n)return r.join("")+h.join(" ");var d=function(){return r.length>0&&" "===r[r.length-1]&&(r.pop(),!0)},v=function(e,o){for(var i of o.split(" "))if(i){if(e+i.length>n){for(;d();)e--;r.push(t),e=0}r.push(i),e+=i.length,r.push(" "),e++}return d()&&e--,e},g=0;for(i=0;i<h.length;i++)g+h[i].length>n&&h[i].includes("{")?g=v(g,h[i]):(g+h[i].length>n&&0!==i?(" "===r[r.length-1]&&r.pop(),r.push(t),g=0):0!==i&&(r.push(" "),g++),r.push(h[i]),g+=h[i].length);return r.join("")},load_pgn:function(e,t){var n=void 0!==t&&"sloppy"in t&&t.sloppy;function r(e){return e.replace(/\\/g,"\\")}e=e.trim();var o="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",i=new RegExp("^(\\[((?:"+r(o)+")|.)*\\])(?:\\s*"+r(o)+"){2}"),a=i.test(e)?i.exec(e)[1]:"";p();var l=function(e,t){for(var n="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",o={},i=e.split(new RegExp(r(n))),a="",l="",c=0;c<i.length;c++){var s=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;a=i[c].replace(s,"$1"),l=i[c].replace(s,"$2"),T(a).length>0&&(o[a]=l)}return o}(a,t),c="";for(var f in l)"fen"===f.toLowerCase()&&(c=l[f]),U([f,l[f]]);if(n){if(c&&!j(c,!0))return!1}else if(!("1"!==l.SetUp||"FEN"in l&&j(l.FEN,!0)))return!1;for(var h=function(e){return`{${function(e){return Array.from(e).map((function(e){return e.charCodeAt(0)<128?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/\%/g,"").toLowerCase()})).join("")}((e=e.replace(new RegExp(r(o),"g")," ")).slice(1,e.length-1))}}`},m=function(e){if(e.startsWith("{")&&e.endsWith("}"))return function(e){return 0==e.length?"":decodeURIComponent("%"+e.match(/.{1,2}/g).join("%"))}(e.slice(1,e.length-1))},v=e.replace(a,"").replace(new RegExp(`({[^}]*})+?|;([^${r(o)}]*)`,"g"),(function(e,t,n){return void 0!==t?h(t):" "+h(`{${n.slice(1)}}`)})).replace(new RegExp(r(o),"g")," "),g=/(\([^\(\)]+\))+?/g;g.test(v);)v=v.replace(g,"");var y=T(v=(v=(v=v.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));y=y.join(",").replace(/,,+/g,",").split(",");for(var w="",b="",A=0;A<y.length;A++){var k=m(y[A]);if(void 0===k)if(null==(w=oe(y[A],n))){if(!(d.indexOf(y[A])>-1))return!1;b=y[A]}else b="",ne(w);else u[F()]=k}return b&&Object.keys(s).length&&!s.Result&&U(["Result",b]),!0},header:function(){return U(arguments)},turn:function(){return r},move:function(e,t){var n=void 0!==t&&"sloppy"in t&&t.sloppy,r=null;if("string"==typeof e)r=oe(e,n);else if("object"==typeof e)for(var o=q(),i=0,a=o.length;i<a;i++)if(e.from===E(o[i].from)&&e.to===E(o[i].to)&&(!("promotion"in o[i])||e.promotion===o[i].promotion)){r=o[i];break}if(!r)return null;var l=ie(r);return ne(r),l},undo:function(){var e=re();return e?ie(e):null},clear:function(){return f()},put:function(e,t){return Q(e,t)},get:function(e){return K(e)},ascii(){for(var e="   +------------------------+\n",n=k.a8;n<=k.h1;n++){if(0===O(n)&&(e+=" "+"87654321"[N(n)]+" |"),null==t[n])e+=" . ";else{var r=t[n].type;e+=" "+(t[n].color===P?r.toUpperCase():r.toLowerCase())+" "}n+1&136&&(e+="|\n",n+=8)}return(e+="   +------------------------+\n")+"     a  b  c  d  e  f  g  h"},remove:function(e){return function(e){var r=K(e);return t[k[e]]=null,r&&r.type===Y&&(n[r.color]=I),$(F()),r}(e)},perft:function(e){return ae(e)},square_color:function(e){if(e in k){var t=k[e];return(N(t)+O(t))%2==0?"light":"dark"}return null},history:function(e){for(var t=[],n=[],r=(void 0!==e&&"verbose"in e&&e.verbose);c.length>0;)t.push(re());for(;t.length>0;){var o=t.pop();r?n.push(ie(o)):n.push(z(o,q({legal:!0}))),ne(o)}return n},get_comment:function(){return u[F()]},set_comment:function(e){u[F()]=e.replace("{","[").replace("}","]")},delete_comment:function(){var e=u[F()];return delete u[F()],e},get_comments:function(){return h(),Object.keys(u).map((function(e){return{fen:e,comment:u[e]}}))},delete_comments:function(){return h(),Object.keys(u).map((function(e){var t=u[e];return delete u[e],{fen:e,comment:t}}))}}};function D(e,t){this.fen=e,this.notation=t,this.toString=function(){return"IllegalMoveException: "+e+" => "+t}}class F{constructor(e=null,t=null,n=!1){if(e){const r=p.parse(e.replace(/\s\s+/g," ").replace(/\n/g," "));this.moves=this.traverse(r[0],t,null,1,n)}else this.clear();this.setUpFen=t}clear(){this.moves=[]}traverse(e,t,n=null,r=1,o=!1){const i=t?new j(t):new j,a=[];let l=n;for(let n of e){if(n.notation){const e=n.notation.notation,c=i.move(e,{sloppy:o});if(!c)throw new D(i.fen(),e);{l?(c.previous=l,l.next=c):c.previous=null,c.ply=r,this.fillMoveFromChessState(c,i),n.nag&&(c.nag=n.nag[0]),n.commentBefore&&(c.commentBefore=n.commentBefore),n.commentMove&&(c.commentMove=n.commentMove),n.commentAfter&&(c.commentAfter=n.commentAfter),c.variations=[];const e=n.variations;if(e.length>0){const n=a.length>0?a[a.length-1].fen:t;for(let t of e)c.variations.push(this.traverse(t,n,l,r,o))}c.variation=a,a.push(c),l=c}}r++}return a}fillMoveFromChessState(e,t){e.fen=t.fen(),e.uci=e.from+e.to+(e.promotion?e.promotion:""),e.variations=[],t.game_over()&&(e.gameOver=!0,t.in_draw()&&(e.inDraw=!0),t.in_stalemate()&&(e.inStalemate=!0),t.insufficient_material()&&(e.insufficientMaterial=!0),t.in_threefold_repetition()&&(e.inThreefoldRepetition=!0),t.in_checkmate()&&(e.inCheckmate=!0)),t.in_check()&&(e.inCheck=!0)}historyToMove(e){const t=[];let n=e;for(t.push(n);n.previous;)t.push(n.previous),n=n.previous;return t.reverse()}validateMove(e,t=null,n=!0){t||this.moves.length>0&&(t=this.moves[this.moves.length-1]);const r=new j(this.setUpFen?this.setUpFen:void 0);if(t){const e=this.historyToMove(t);for(const t of e)r.move(t)}const o=r.move(e,{sloppy:n});return o&&this.fillMoveFromChessState(o,r),o}addMove(e,t=null,n=!0){t||this.moves.length>0&&(t=this.moves[this.moves.length-1]);const r=this.validateMove(e,t,n);if(!r)throw new Error("invalid move");return r.previous=t,t?(r.ply=t.ply+1,r.uci=r.from+r.to+(r.promotion?r.promotion:""),t.next?(t.next.variations.push([]),r.variation=t.next.variations[t.next.variations.length-1],r.variation.push(r)):(t.next=r,r.variation=t.variation,t.variation.push(r))):(r.variation=this.moves,r.ply=1,this.moves.push(r)),r}render(e=!0,t=!0){const n=(r,o=!1)=>{let i="";for(let a of r){if(a.ply%2==1?i+=Math.floor(a.ply/2)+1+". ":(0===i.length||o)&&(i+=a.ply/2+"... "),o=!1,t&&a.nag&&(i+="$"+a.nag+" "),e&&a.commentBefore&&(i+="{"+a.commentBefore+"} ",o=!0),i+=a.san+" ",e&&a.commentMove&&(i+="{"+a.commentMove+"} ",o=!0),e&&a.commentAfter&&(i+="{"+a.commentAfter+"} ",o=!0),a.variations.length>0)for(let e of a.variations)i+="("+n(e)+") ",o=!0;i+=" "}return i};let r=n(this.moves);return r=r.replace(/\s+\)/g,")"),r=r.replace(/\s\s+/g," ").trim(),r}}class U{constructor(e="",t={}){const n=e.match(/]\s*\n\s*\n/),r=n?n.index+2:e.length,o=e.substring(0,r);console.log("headerString: "+o);const i=e.substring(r);console.log("historyString: "+i);const a=!!t.sloppy;this.header=new u(o),"1"===this.header.tags.SetUp&&this.header.tags.FEN?this.history=new F(i,this.header.tags.FEN,a):this.history=new F(i,null,a)}wrap(e,t){const n=e.split(" ");let r=[],o="";for(let e=0;e<n.length;e++){const i=n[e];o.length+i.length<t?o+=i+" ":(r.push(o.trim()),o=i+" ")}return r.push(o.trim()),r.join("\n")}render(e=!0,t=!0,n=!0){const r=e?this.header.render()+"\n":"";let o=this.history.render(t,n);return this.header.tags[s]&&(o+=" "+this.header.tags[s]),r+this.wrap(o,80)}}function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function K(){K=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function s(e,t,n,o){var i=t&&t.prototype instanceof h?t:h,a=Object.create(i.prototype),l=new x(o||[]);return r(a,"_invoke",{value:A(e,n,l)}),a}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var f={};function h(){}function p(){}function m(){}var d={};c(d,i,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(N([])));g&&g!==t&&n.call(g,i)&&(d=g);var y=m.prototype=h.prototype=Object.create(d);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function o(r,i,a,l){var c=u(e[r],e,i);if("throw"!==c.type){var s=c.arg,f=s.value;return f&&"object"==$(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){o("next",e,a,l)}),(function(e){o("throw",e,a,l)})):t.resolve(f).then((function(e){s.value=e,a(s)}),(function(e){return o("throw",e,a,l)}))}l(c.arg)}var i;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){o(e,n,t,r)}))}return i=i?i.then(r,r):r()}})}function A(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var l=k(a,n);if(l){if(l===f)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=u(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function k(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var o=u(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,f;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function B(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(B,this),this.reset(!0)}function N(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return p.prototype=m,r(y,"constructor",{value:m,configurable:!0}),r(m,"constructor",{value:p,configurable:!0}),p.displayName=c(m,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,l,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},w(b.prototype),c(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new b(s(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(y),c(y,l,"Generator"),c(y,i,(function(){return this})),c(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=N,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(L),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),L(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;L(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:N(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},e}function Q(e,t,n,r,o,i,a){try{var l=e[i](a),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,o)}function V(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){Q(i,r,o,a,l,"next",e)}function l(e){Q(i,r,o,a,l,"throw",e)}a(void 0)}))}}var q=-1,z=-1,H=new U(""),W=null,Z=null,J=!1,X=1,ee=null;function te(e,t,n){var r=BABYLON.MeshBuilder.CreateSphere("fireball",{diameter:.5},scene);r.position=e,r.isVisible=!1;var o=new BABYLON.ParticleSystem("fireball",2e3,scene);o.emitter=r,o.particleTexture=new BABYLON.Texture("assets/fireparticle.png",scene),o.useAlphaFromTexture=!0,o.color1=new BABYLON.Color4(1,.5,0,1),o.color2=new BABYLON.Color4(1,0,0,1),o.colorDead=new BABYLON.Color4(0,0,0,0),o.minSize=.25,o.maxSize=1.5,o.minLifeTime=.1,o.maxLifeTime=.5,o.emitRate=300,o.blendMode=BABYLON.ParticleSystem.BLENDMODE_ADD,o.gravity=new BABYLON.Vector3(0,-9.81,0),o.direction1=new BABYLON.Vector3(0,.1,0),o.minEmitPower=1,o.maxEmitPower=10,o.minEmitBox=new BABYLON.Vector3(-.1,0,-.1),o.maxEmitBox=new BABYLON.Vector3(.1,0,.1),o.updateFunction=function(e){for(var t=0;t<e.length;t++)e[t].size*=.85},o.start();var i=new BABYLON.Animation("fireballAnimation","position",60,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),a=[{frame:0,value:e},{frame:60*n,value:t}];i.setKeys(a),r.animations.push(i),scene.beginAnimation(r,0,60*n,!1,1),scene.registerAfterRender((function(){o.emitter=r})),setTimeout((function(){r.dispose(),o.stop(),o.dispose()}),1e3*n)}function ne(e){var t=W.meshes.slice();if(-1==e)var n=he("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1");else n=he(H.history.moves[e].fen);for(var r=0;r<8;r++)for(var o=0;o<8;o++)for(var i=0;i<t.length;i++)if(t[i].piece==n[r][o]){t[i].parent.position=oe(String.fromCharCode(97+o)+(8-r)),t[i].piecePosition.coordinate=String.fromCharCode(97+o)+(8-r),t[i].piecePosition.x=o,t[i].piecePosition.y=r,t[i].isVisible=!0,null!=t[i].weapon&&(t[i].weapon.isVisible=!0),scene.stopAnimation(t[i].skeleton);var a=t[i].skeleton.getAnimationRange("Idle");scene.beginAnimation(t[i].skeleton,a.from,a.to,!0,1),t.splice(i,1);break}q=z,J=!1}function re(e){var t=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("whiteFlashTexture"),n=new BABYLON.GUI.Rectangle;n.width=1,n.height=1,n.background="white",n.alpha=0,n.isPointerBlocker=!0,t.addControl(n);var r=[];r.push({frame:0,value:0}),r.push({frame:10,value:1}),r.push({frame:20,value:0});var o=new BABYLON.Animation("whiteFlash","alpha",60,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);return o.setKeys(r),n.animations=[],n.animations.push(o),scene.beginAnimation(n,0,20,!1,1,(function(){t.dispose()})),new Promise((function(t){setTimeout(t,e)}))}function oe(e){for(var t=0;t<Z.length;t++)for(var n=0;n<Z[t].length;n++)if(Z[t][n][1]==e)return Z[t][n][0]}function ie(e,t){return ae.apply(this,arguments)}function ae(){return(ae=V(K().mark((function e(t,n){var r,o,i,a,l,c,s,u,f,h,p,m,d;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Starting attack"),r=engine.getFps(),o=t.skeleton.getAnimationRange("Attack"),i=n.skeleton.getAnimationRange("Death"),a=X,l=r/(o.to-o.from)/a,c=t.parent.position,s=n.parent.position,ue(t.parent,n.parent.position),"n"!=t.name.charAt(1)&&"r"!=t.name.charAt(1)||(u=new BABYLON.Animation("moveAnimation","position",r,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),(f=[]).push({frame:0,value:c}),f.push({frame:a*r,value:s}),u.setKeys(f),t.parent.animations.push(u),scene.beginAnimation(t.parent,0,a*r,!1,1)),h=scene.beginAnimation(t.skeleton,o.from,o.to,!1,l),scene.beginAnimation(n.skeleton,i.from,i.to,!1,l),"b"!=t.name.charAt(1)&&"q"!=t.name.charAt(1)||(p=new BABYLON.Vector3(0,1.5,0),te(c.clone().addInPlace(p),s.clone().addInPlace(p),a/1.5)),m=1e3/r*(o.to-o.from)*a,e.next=17,new Promise((function(e){return setTimeout(e,m/2)}));case 17:return re(500),e.next=20,h.waitAsync();case 20:"n"!=t.name.charAt(1)&&"r"!=t.name.charAt(1)||(scene.stopAnimation(t),scene.stopAnimation(t.skeleton),t.parent.rotation.y=0,d=t.skeleton.getAnimationRange("Idle"),scene.beginAnimation(t.skeleton,d.from,d.to,!0,1),pe(q+1)),null!=n.weapon&&(n.weapon.isVisible=!1),n.isVisible=!1,n.piecePosition.coordinate=null,"n"!=t.name.charAt(1)&&"r"!=t.name.charAt(1)||(J=!1),console.log("Attack Anim over");case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(e,t){e.piecePosition.coordinate=t}function ce(e,t,n,r){return se.apply(this,arguments)}function se(){return(se=V(K().mark((function e(t,n,r,o){var i,a,l,c,s,u,f,h,p,m,d,v,g;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Starting move to"),ue(t.parent,r),i=t.parent,l=!0,c=1,s=engine.getFps(),u=X,f=n,h=r,console.log("Current FPS: "+engine.getFps().toFixed()),"n"==t.name.charAt(1)?(a=t.skeleton.getAnimationRange("Jump"),l=!1):a=t.skeleton.getAnimationRange("Walk"),console.log("from:"+a.from+",to:"+a.to),0==l?(c=s/(a.to-a.from)/u,console.log("animationSpeed:"+c)):(p=BABYLON.Vector3.Distance(n,r),c*=p/1.5/u),m=new BABYLON.Animation("moveAnimation","position",s,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),(d=[]).push({frame:0,value:f}),d.push({frame:u*s,value:h}),m.setKeys(d),i.animations.push(m),v=scene.beginAnimation(i,0,u*s,!1,1),scene.stopAnimation(t.skeleton),scene.beginAnimation(t.skeleton,a.from,a.to,l,c),e.next=24,v.waitAsync();case 24:console.log("Move Anim over"),scene.stopAnimation(t),scene.stopAnimation(t.skeleton),t.parent.rotation.y=0,g=t.skeleton.getAnimationRange("Idle"),scene.beginAnimation(t.skeleton,g.from,g.to,!0,1),o||(pe(q+1),J=!1);case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(e,t){var n=t.subtract(e.position);e.rotation.y=Math.atan2(n.x,n.z),"b"==e.getChildren()[0].name.charAt(0)?e.rotation.y-=BABYLON.Tools.ToRadians(90):e.rotation.y+=BABYLON.Tools.ToRadians(90)}function fe(){return(fe=V(K().mark((function e(t){var n,r,o,i,a,l,c,s;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=H.history.moves[t],console.log("Moving piece:"+n.from),null==n){e.next=38;break}for(r=null,o=null,console.log("Container:"+W.meshes),i=0;i<W.meshes.length;i++)W.meshes[i].piecePosition.coordinate==n.from&&(r=W.meshes[i]),W.meshes[i].piecePosition.coordinate==n.to&&(o=W.meshes[i]);if(console.log("flag: "+n.flags),console.log("frommesh: "+r),"c"!=n.flags){e.next=19;break}return a=oe(n.to),e.next=13,ie(r,o);case 13:if("n"==r.name.charAt(1)||"r"==r.name.charAt(1)){e.next=16;break}return e.next=16,ce(r,r.parent.position,a,!1);case 16:le(r,n.to),e.next=38;break;case 19:if("n"!=n.flags&&"b"!=n.flags){e.next=26;break}return a=oe(n.to),e.next=23,ce(r,r.parent.position,a,!1);case 23:le(r,n.to),e.next=38;break;case 26:if("k"!=n.flags&&"q"!=n.flags){e.next=38;break}if(l=null,c=null,s=null,"k"==n.flags)for(i=0;i<W.meshes.length;i++)W.meshes[i].piecePosition.coordinate=="h"+r.piecePosition.coordinate.charAt(1)&&(l=W.meshes[i],c="f"+l.piecePosition.coordinate.charAt(1),s=oe(c));else for(i=0;i<W.meshes.length;i++)W.meshes[i].piecePosition.coordinate=="a"+r.piecePosition.coordinate.charAt(1)&&(l=W.meshes[i],c="d"+l.piecePosition.coordinate.charAt(1),s=oe(c));return e.next=33,ce(l,l.parent.position,s,!0);case 33:return a=oe(n.to),e.next=36,ce(r,r.parent.position,a,!1);case 36:le(r,n.to),le(l,c);case 38:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e){for(var t=[["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""]],n=e.split("/",8),r=0;r<n.length;r++)for(var o=0,i=0;i<n[r].length&&" "!=n[r].charAt(i);i++)if(isNaN(n[r].charAt(i)+1))n[r].charAt(i).toUpperCase()==n[r].charAt(i)?(t[r][o]="w"+n[r].charAt(i).toLowerCase(),o+=1):(t[r][o]="b"+n[r].charAt(i),o+=1);else for(var a=0;a<n[r].charAt(i);a++)t[r][o]="em",o+=1;return t}function pe(e){q=e,ee.text="Halfmove: "+(z+1)+"/"+H.history.moves.length+" ("+(q+1)+")"}function me(){console.log("Refreshing. Current move: "+q+", Required move: "+z+", Move in progress: "+J),q<z&&!J?(function(e){fe.apply(this,arguments)}(q+1),J=!0):q>z&&!J&&(J=!0,ne(z))}function de(e){console.log("Setting PGN"),console.log(e);try{q=-1,z=-1,J=!1,H=new U(e.normalize()),console.log(H)}catch(e){console.error("Error parsing PGN:",e)}ne(-1)}function ve(e){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ve(e)}function ge(){ge=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function s(e,t,n,o){var i=t&&t.prototype instanceof h?t:h,a=Object.create(i.prototype),l=new x(o||[]);return r(a,"_invoke",{value:A(e,n,l)}),a}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var f={};function h(){}function p(){}function m(){}var d={};c(d,i,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(N([])));g&&g!==t&&n.call(g,i)&&(d=g);var y=m.prototype=h.prototype=Object.create(d);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function o(r,i,a,l){var c=u(e[r],e,i);if("throw"!==c.type){var s=c.arg,f=s.value;return f&&"object"==ve(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){o("next",e,a,l)}),(function(e){o("throw",e,a,l)})):t.resolve(f).then((function(e){s.value=e,a(s)}),(function(e){return o("throw",e,a,l)}))}l(c.arg)}var i;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){o(e,n,t,r)}))}return i=i?i.then(r,r):r()}})}function A(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var l=k(a,n);if(l){if(l===f)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=u(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function k(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var o=u(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,f;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function B(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(B,this),this.reset(!0)}function N(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return p.prototype=m,r(y,"constructor",{value:m,configurable:!0}),r(m,"constructor",{value:p,configurable:!0}),p.displayName=c(m,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,l,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},w(b.prototype),c(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new b(s(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(y),c(y,l,"Generator"),c(y,i,(function(){return this})),c(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=N,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(L),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),L(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;L(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:N(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},e}function ye(e,t,n,r,o,i,a){try{var l=e[i](a),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,o)}function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==ve(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==ve(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r.key),"symbol"===ve(o)?o:String(o)),r)}var o}function be(e,t,n){return t&&we(e.prototype,t),n&&we(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var Ae=be((function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.coordinate=t,this.x=n,this.y=r}));function ke(){var e;return e=ge().mark((function e(t){return ge().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){var n=he("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),r=new BABYLON.ShadowGenerator(2048,scene.lights[0]);r.usePercentageCloserFiltering=!0;var o=new BABYLON.AssetContainer(scene),i=[[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null]];l().then((function(t){for(var a=0;a<t.meshes.length;a++)if("Sword"==t.meshes[a].name)var l=t.meshes[a];else if("Scepter"==t.meshes[a].name)var c=t.meshes[a];else if("Shield"==t.meshes[a].name)var s=t.meshes[a];else if("Staff"==t.meshes[a].name)var u=t.meshes[a];else if("Spear"==t.meshes[a].name)var f=t.meshes[a];else if("Board"==t.meshes[a].name){var h=t.meshes[a].clone("Chessboard");h.receiveShadows=!0}else if("BoardDecoration"==t.meshes[a].name)t.meshes[a].clone("ChessboardDecoration").receiveShadows=!0;else if("PawnMesh"==t.meshes[a].name)var p=t.meshes[a],m=p.skeleton;else if("BishopMesh"==t.meshes[a].name)var d=t.meshes[a];else if("KnightMesh"==t.meshes[a].name)var v=t.meshes[a];else if("RookMesh"==t.meshes[a].name)var g=t.meshes[a];else if("QueenMesh"==t.meshes[a].name)var y=t.meshes[a];else if("KingMesh"==t.meshes[a].name)var w=t.meshes[a];for(var b=h.getBoundingInfo(),A=b.boundingBox.minimumWorld,k=b.boundingBox.maximumWorld,B=(k.x-A.x)/8,L=(k.z-A.z)/8,x=0;x<8;x++)for(var N=0;N<8;N++){var O=A.x+B/2+x*B,E=A.z+L/2+N*L,S=null;if(i[x][N]=[new BABYLON.Vector3(O,0,E),String.fromCharCode(97+N)+(8-x)],"p"==n[x][N].charAt(1)){(S=p.clone("Pawn")).skeleton=m.clone("Skeleton");var C=f.clone("newSpear"),T=S.skeleton.getBoneIndexByName("mixamorig:RightHandMiddle1");C.position.addInPlace(new BABYLON.Vector3(0,10,10)),C.attachToBone(S.skeleton.bones[T],S),C.scaling=new BABYLON.Vector3(80,80,80),C.rotationQuaternion=null,C.rotation.y=BABYLON.Tools.ToRadians(192),S.weapon=C}else if("n"==n[x][N].charAt(1)){(S=v.clone("Knight")).skeleton=v.skeleton.clone("KnightSkeleton");var _=l.clone("newSword");T=S.skeleton.getBoneIndexByName("mixamorig:RightHandMiddle1"),_.position.addInPlace(new BABYLON.Vector3(0,10,10)),_.attachToBone(S.skeleton.bones[T],S),_.scaling=new BABYLON.Vector3(80,80,80),_.rotationQuaternion=null,_.rotation.z=BABYLON.Tools.ToRadians(30),_.rotation.y=BABYLON.Tools.ToRadians(192),S.weapon=_}else if("b"==n[x][N].charAt(1)){(S=d.clone("Bishop")).skeleton=d.skeleton.clone("BishopSkeleton");var P=u.clone("newStaff");T=S.skeleton.getBoneIndexByName("mixamorig:RightHandMiddle1"),P.position.addInPlace(new BABYLON.Vector3(0,10,10)),P.attachToBone(S.skeleton.bones[T],S),P.scaling=new BABYLON.Vector3(80,80,80),P.rotationQuaternion=null,P.rotation.y=BABYLON.Tools.ToRadians(192),S.weapon=P}else if("r"==n[x][N].charAt(1)){(S=g.clone("Rook")).skeleton=g.skeleton.clone("RookSkeleton");var I=s.clone("newShield");T=S.skeleton.getBoneIndexByName("mixamorig:RightHandMiddle1"),I.position.addInPlace(new BABYLON.Vector3(10,65,-20)),I.attachToBone(S.skeleton.bones[T],S),I.scaling=new BABYLON.Vector3(80,80,80),I.rotationQuaternion=null,I.rotation.x=BABYLON.Tools.ToRadians(95),I.rotation.y=BABYLON.Tools.ToRadians(192),S.weapon=I}else if("q"==n[x][N].charAt(1))(S=y.clone("Queen")).skeleton=y.skeleton.clone("QueenSkeleton");else if("k"==n[x][N].charAt(1)){(S=w.clone("King")).skeleton=w.skeleton.clone("KingSkeleton");var R=c.clone("newScepter");T=S.skeleton.getBoneIndexByName("mixamorig:RightHandMiddle1"),R.position.addInPlace(new BABYLON.Vector3(0,10,10)),R.attachToBone(S.skeleton.bones[T],S),R.scaling=new BABYLON.Vector3(80,80,80),R.rotationQuaternion=null,R.rotation.z=BABYLON.Tools.ToRadians(30),R.rotation.y=BABYLON.Tools.ToRadians(192),S.weapon=R}if(S){S.piece=n[x][N],r.addShadowCaster(S),S.skeleton.animationPropertiesOverride=new BABYLON.AnimationPropertiesOverride,S.skeleton.animationPropertiesOverride.enableBlending=!0,S.skeleton.animationPropertiesOverride.blendingSpeed=.075,S.skeleton.animationPropertiesOverride.loopMode=1;var M=S.skeleton.getAnimationRange("Idle");scene.beginAnimation(S.skeleton,M.from,M.to,!0,1);var Y=S.material.clone("BlackMaterial");Y.disableLighting=!0;var G=S.material.clone("WhiteMaterial");if("b"==n[x][N].charAt(0)){for(S.material=Y,I&&(I.material=I.material.clone("BlackShield")),a=0;a<S.material.subMaterials.length;a++)"Metal"==S.material.subMaterials[a].name||"WhiteCloth"==S.material.subMaterials[a].name?(Y.subMaterials[a]=Y.subMaterials[a].clone("Black"),Y.subMaterials[a].albedoColor=new BABYLON.Color3(.1,.1,.1),I&&(I.material.subMaterials[0]=Y.subMaterials[a])):"Metal2"==S.material.subMaterials[a].name&&(Y.subMaterials[a]=Y.subMaterials[a].clone("Silver"),Y.subMaterials[a].albedoColor=new BABYLON.Color3(.8,.8,.9),I&&(I.material.subMaterials[1]=Y.subMaterials[a]),P&&(P.material=Y.subMaterials[a]),R&&(R.material=Y.subMaterials[a]));S.rotation.y-=BABYLON.Tools.ToRadians(90)}else"w"==n[x][N].charAt(0)&&(S.material=G,S.rotation.y+=BABYLON.Tools.ToRadians(90));S.name=n[x][N];var j=new Ae(String.fromCharCode(97+N)+(8-x),N,x),D=new BABYLON.TransformNode("parentNode",scene);S.setParent(D,!0),D.position=new BABYLON.Vector3(O,0,E),S.piecePosition=j,o.meshes.push(S)}}e([o,i])}))})));case 1:case"end":return e.stop()}}),e)})),ke=function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){ye(i,r,o,a,l,"next",e)}function l(e){ye(i,r,o,a,l,"throw",e)}a(void 0)}))},ke.apply(this,arguments)}console.log('[Event "Norway Chess 2023"]\n[Site "Chess.com"]\n[Date "2023.06.09"]\n[Round "17"]\n[White "Nakamura, Hikaru"]\n[Black "Caruana, Fabiano"]\n[Result "1-0"]\n[WhiteElo "2775"]\n[BlackElo "2773"]\n[TimeControl "40/7200:0+10"]\n\n1. e4 {[%timestamp 30][%clk 1:59:57]} 1... e5 {[%timestamp 50][%clk 1:59:55]} 2.\nNf3 {[%timestamp 150][%clk 1:59:42]} 2... Nc6 {[%timestamp 60][%clk 1:59:49]} 3.\nBc4 {[%timestamp 100][%clk 1:59:32]} 3... Nf6 {[%timestamp 80][%clk 1:59:41]} 4.\nNg5 {[%timestamp 80][%clk 1:59:24]} 4... d5 {[%timestamp 150][%clk 1:59:26]} 5.\nexd5 {[%timestamp 110][%clk 1:59:13]} 5... Na5 {[%timestamp 120][%clk 1:59:14]}\n6. Bb5+ {[%timestamp 70][%clk 1:59:06]} 6... c6 {[%timestamp 50][%clk 1:59:09]}\n7. dxc6 {[%timestamp 40][%clk 1:59:02]} 7... bxc6 {[%timestamp 40][%clk\n1:59:05]} 8. Bd3 {[%timestamp 80][%clk 1:58:54]} 8... Nd5 {[%timestamp 360][%clk\n1:58:29]} 9. Nf3 {[%timestamp 60][%clk 1:58:48]} 9... Bd6 {[%timestamp 500][%clk\n1:57:39]} 10. O-O {[%timestamp 170][%clk 1:58:31]} 10... Nf4 {[%timestamp\n270][%clk 1:57:12]} 11. Nc3 {[%timestamp 80][%clk 1:58:23]} 11... Nxd3\n{[%timestamp 730][%clk 1:55:59]} 12. cxd3 {[%timestamp 60][%clk 1:58:17]} 12...\nO-O {[%timestamp 40][%clk 1:55:55]} 13. b3 {[%timestamp 40][%clk 1:58:13]} 13...\nRe8 {[%timestamp 2240][%clk 1:52:11]} 14. Re1 {[%timestamp 600][%clk 1:57:13]}\n14... c5 {[%timestamp 7960][%clk 1:38:55]} 15. Ba3 {[%timestamp 290][%clk\n1:56:44]} 15... Nc6 {[%timestamp 4950][%clk 1:30:40]} 16. Ne4 {[%timestamp\n730][%clk 1:55:31]} 16... Bf8 {[%timestamp 1400][%clk 1:28:20]} 17. Rc1\n{[%timestamp 260][%clk 1:55:05]} 17... f5 {[%timestamp 860][%clk 1:26:54]} 18.\nNxc5 {[%timestamp 13200][%clk 1:33:05]} 18... Qd5 {[%timestamp 19800][%clk\n0:53:54]} 19. Qc2 {[%timestamp 3210][%clk 1:27:44]} 19... Rd8 {[%timestamp\n3800][%clk 0:47:34]} 20. Qc4 {[%timestamp 6490][%clk 1:16:55]} 20... Qxc4\n{[%timestamp 50][%clk 0:47:29]} 21. Rxc4 {[%timestamp 160][%clk 1:16:39]} 21...\nRd5 {[%timestamp 50][%clk 0:47:24]} 22. Rec1 {[%timestamp 9610][%clk 1:00:38]}\n22... Bd6 {[%timestamp 2090][%clk 0:43:55]} 23. Bb2 {[%timestamp 3650][%clk\n0:54:33]} 23... Ne7 {[%timestamp 250][%clk 0:43:30]} 24. R4c2 {[%timestamp\n600][%clk 0:53:33]} 24... Rb8 {[%timestamp 5700][%clk 0:34:00]} 25. d4\n{[%timestamp 510][%clk 0:52:42]} 25... exd4 {[%timestamp 1510][%clk 0:31:29]}\n26. Nxd4 {[%timestamp 760][%clk 0:51:26]} 26... a5 {[%timestamp 260][%clk\n0:31:03]} 27. Nf3 {[%timestamp 3630][%clk 0:45:23]} 27... h6 {[%timestamp\n2140][%clk 0:27:29]} 28. Na4 {[%timestamp 7100][%clk 0:33:33]} 28... Ba6\n{[%timestamp 4670][%clk 0:19:42]} 29. Nc3 {[%timestamp 890][%clk 0:32:04]} 29...\nRc5 {[%timestamp 20][%clk 0:19:40]} 30. Ba3 {[%timestamp 550][%clk 0:31:09]}\n30... Rc6 {[%timestamp 140][%clk 0:19:26]} 31. Bxd6 {[%timestamp 380][%clk\n0:30:31]} 31... Rxd6 {[%timestamp 30][%clk 0:19:23]} 32. Na4 {[%timestamp\n130][%clk 0:30:18]} 32... Nd5 {[%timestamp 2450][%clk 0:15:18]} 33. Rc6\n{[%timestamp 2920][%clk 0:25:26]} 33... Rxc6 {[%timestamp 680][%clk 0:14:10]}\n34. Rxc6 {[%timestamp 110][%clk 0:25:15]} 34... Nb4 {[%timestamp 30][%clk\n0:14:07]} 35. Rd6 {[%timestamp 520][%clk 0:24:23]} 35... Bb7 {[%timestamp\n90][%clk 0:13:58]} 36. Nc3 {[%timestamp 2900][%clk 0:19:33]} 36... Re8\n{[%timestamp 520][%clk 0:13:06]} 37. h4 {[%timestamp 960][%clk 0:17:57]} 37...\nf4 {[%timestamp 820][%clk 0:11:44]} 38. Rd4 {[%timestamp 1410][%clk 0:15:36]}\n38... Rf8 {[%timestamp 1240][%clk 0:09:40]} 39. Ne5 {[%timestamp 980][%clk\n0:13:58]} 39... Re8 {[%timestamp 930][%clk 0:08:07]} 40. Nc4 {[%timestamp\n3050][%clk 0:08:53]} 40... f3 {[%timestamp 190][%clk 0:07:48]} 41. gxf3\n{[%timestamp 620][%clk 0:07:51]} 41... Bxf3 {[%timestamp 0][%clk 0:07:48]} 42.\nKh2 {[%timestamp 850][%clk 0:06:26]} 42... Nc2 {[%timestamp 870][%clk 0:06:21]}\n43. Rd3 {[%timestamp 380][%clk 0:05:48]} 43... Ba8 {[%timestamp 970][%clk\n0:04:44]} 44. Kg3 {[%timestamp 140][%clk 0:05:34]} 44... Kh7 {[%timestamp\n130][%clk 0:04:31]} 45. Ne3 {[%timestamp 50][%clk 0:05:29]} 45... Nb4\n{[%timestamp 860][%clk 0:03:05]} 46. Rd6 {[%timestamp -40][%clk 0:05:33]} 46...\nNc6 {[%timestamp 300][%clk 0:02:35]} 47. Ncd5 {[%timestamp 310][%clk 0:05:02]}\n47... Rf8 {[%timestamp 80][%clk 0:02:27]} 48. Nc7 {[%timestamp 870][%clk\n0:03:35]} 48... Bb7 {[%timestamp -80][%clk 0:02:35]} 49. Ne6 {[%timestamp\n230][%clk 0:03:12]} 49... Rf7 {[%timestamp -10][%clk 0:02:36]} 50. f4\n{[%timestamp 30][%clk 0:03:09]} 50... Ba8 {[%timestamp 250][%clk 0:02:11]} 51.\nh5 {[%timestamp 70][%clk 0:03:02]} 51... Ra7 {[%timestamp 850][%clk 0:00:46]}\n52. a3 {[%timestamp 20][%clk 0:03:00]} 52... Kg8 {[%timestamp 150][%clk\n0:00:31]} 53. f5 {[%timestamp 110][%clk 0:02:49]} 53... Re7 {[%timestamp\n140][%clk 0:00:17]} 54. Kf4 {[%timestamp 90][%clk 0:02:40]} 54... Ra7\n{[%timestamp 30][%clk 0:00:14]} 55. d4 {[%timestamp -10][%clk 0:02:41]} 1-0');var Be=new U(""),Le=null,xe=null;(function(){return r.apply(this,arguments)})().then((function(e){(function(e){return ke.apply(this,arguments)})(Be).then((function(t){var n;n=Be,console.log("Starting refresh"),console.log(n),H=n,setInterval(me,100),function(e,t){console.log(e),W=e,Z=t,console.log("Coord pos:"+Z);var n=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"),r=new BABYLON.GUI.StackPanel("buttonStackPanel");r.width="100%",r.height="50px",r.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,r.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM,r.isVertical=!1,(ee=new BABYLON.GUI.TextBlock("movesLabel")).width="100%",ee.height="50px",ee.color="white",ee.text="Halfmove: 0/"+H.history.moves.length+" (0)";var o=BABYLON.GUI.Button.CreateSimpleButton("leftButton","<");o.width="50%",o.height="50px",o.color="grey",o.background="white",o.paddingRight="10px",o.onPointerDownObservable.add((function(){z-=z>-1?1:0,ee.text="Halfmove: "+(z+1)+"/"+H.history.moves.length+" ("+(q+1)+")"})),r.addControl(o);var i=BABYLON.GUI.Button.CreateSimpleButton("rightButton",">");i.width="50%",i.height="50px",i.color="grey",i.background="white",i.paddingLeft="10px",i.onPointerDownObservable.add((function(){z+=z<H.history.moves.length-1?1:0,ee.text="Halfmove: "+(z+1)+"/"+H.history.moves.length+" ("+(q+1)+")"})),r.addControl(i);var a=new BABYLON.GUI.StackPanel("inputStackPanel");a.width="100%",a.height="100px",a.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,a.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,a.isVertical=!0;var l=new BABYLON.GUI.InputTextArea("pgnInput");l.width="100%",l.height="50px",l.color="grey",l.background="white",l.autoStretchWidth=!1,l.placeholderText="Please paste a PGN here",l.placeholderColor="grey",l.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,a.addControl(l);var c=BABYLON.GUI.Button.CreateSimpleButton("pgnSubmitButton","SUBMIT PGN");c.width="50%",c.height="50px",c.color="grey",c.background="white",c.paddingLeft="10px",c.onPointerDownObservable.add((function(){null!=l.text&&""!=l.text&&de(l.text)})),a.addControl(c);var s=new BABYLON.GUI.StackPanel("sliderStackPanel");s.width="100%",s.height="100px",s.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,s.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;var u=new BABYLON.GUI.TextBlock("sliderLabel");u.width="100%",u.height="50px",u.color="white",u.text="Move Speed (1s)",s.addControl(u);var f=new BABYLON.GUI.Slider("moveSpeedSlider");f.width="100%",f.height="50px",f.minimum=.1,f.maximum=2,f.color="white",f.value=X,f.onValueChangedObservable.add((function(e){X=e,u.text="Move Speed ("+e.toFixed(1)+"s)"})),s.addControl(f);var h=new BABYLON.GUI.StackPanel("mainStackPanel");h.width="20%",h.height="300px",h.paddingTop="10px",h.paddingRight="10px",h.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT,h.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,h.isVertical=!0,n.addControl(h),h.addControl(a),h.addControl(s),h.addControl(ee),h.addControl(r),scene.onKeyboardObservable.add((function(e){if(e.type===BABYLON.KeyboardEventTypes.KEYUP)switch(e.event.key){case"[":z-=z>-1?1:0,ee.text="Moves:"+z+"/"+H.history.moves.length;break;case"]":z+=z<H.history.moves.length-1?1:0,ee.text="Moves:"+z+"/"+H.history.moves.length;break;case"Enter":case"return":null!=l.text&&""!=l.text&&de(l.text);break;case"p":te(new BABYLON.Vector3.Zero,new BABYLON.Vector3(4,4,4),.5)}}))}(t[0],t[1]),Le=e[0],xe=e[1],window.addEventListener("resize",(function(){Le.resize()})),Le.runRenderLoop((function(){xe.render()})),BABYLON.Inspector.Show(xe,{})}))}))})();