/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){e=function(){return n};var n={},r=Object.prototype,o=r.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},l=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function f(t,e,n,r){var o=e&&e.prototype instanceof m?e:m,a=Object.create(o.prototype),l=new O(r||[]);return i(a,"_invoke",{value:L(t,n,l)}),a}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}n.wrap=f;var p={};function m(){}function v(){}function d(){}var g={};u(g,l,(function(){return this}));var y=Object.getPrototypeOf,w=y&&y(y(E([])));w&&w!==r&&o.call(w,l)&&(g=w);var b=d.prototype=m.prototype=Object.create(g);function A(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(e,n){function r(i,a,l,s){var c=h(e[i],e,a);if("throw"!==c.type){var u=c.arg,f=u.value;return f&&"object"==t(f)&&o.call(f,"__await")?n.resolve(f.__await).then((function(t){r("next",t,l,s)}),(function(t){r("throw",t,l,s)})):n.resolve(f).then((function(t){u.value=t,l(u)}),(function(t){return r("throw",t,l,s)}))}s(c.arg)}var a;i(this,"_invoke",{value:function(t,e){function o(){return new n((function(n,o){r(t,e,n,o)}))}return a=a?a.then(o,o):o()}})}function L(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var l=x(a,n);if(l){if(l===p)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=h(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===p)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}function x(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var o=h(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,p;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function B(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(B,this),this.reset(!0)}function E(t){if(t){var e=t[l];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(o.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:S}}function S(){return{value:void 0,done:!0}}return v.prototype=d,i(b,"constructor",{value:d,configurable:!0}),i(d,"constructor",{value:v,configurable:!0}),v.displayName=u(d,c,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},n.awrap=function(t){return{__await:t}},A(k.prototype),u(k.prototype,s,(function(){return this})),n.AsyncIterator=k,n.async=function(t,e,r,o,i){void 0===i&&(i=Promise);var a=new k(f(t,e,r,o),i);return n.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},A(b),u(b,c,"Generator"),u(b,l,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},n.values=E,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(N),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var l=o.call(i,"catchLoc"),s=o.call(i,"finallyLoc");if(l&&s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;N(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:E(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},n}function n(t,e,n,r,o,i,a){try{var l=t[i](a),s=l.value}catch(t){return void n(t)}l.done?e(s):Promise.resolve(s).then(r,o)}function r(){var t;return t=e().mark((function t(){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){var n=document.getElementById("renderCanvas");BABYLON.Effect.ShadersStore.flashFragmentShader="\n    varying vec2 vUV;\n    uniform sampler2D textureSampler;\n    uniform float flashIntensity;\n    uniform vec3 color;\n\n    void main(void) {\n        vec4 baseColor = texture2D(textureSampler, vUV);\n        gl_FragColor = mix(baseColor, vec4(color, 1.0), flashIntensity);\n    }\n";var r=new BABYLON.Engine(n,!0,{disableWebGL2Support:!1});window.engine=r;var o=function(){BABYLON.Animation.AllowMatricesInterpolation=!0;var t=new BABYLON.Scene(r),e={skyboxSize:100,groundSize:100,skyboxColor:new BABYLON.Color3(.25,.5,1),groundColor:new BABYLON.Color3(.05,.05,.15),cameraExposure:1,enableGroundShadow:!1,rootPosition:new BABYLON.Vector3(0,-2,0),toneMappingEnabled:!0},o=t.createDefaultEnvironment(e);t.environmentIntensity=2;var i=new BABYLON.Texture("./assets/correlatedMSBRDF_RGBD.png",t,!0,!0,BABYLON.Texture.BILINEAR_SAMPLINGMODE),a=new BABYLON.CubeTexture("./assets/skybox.dds",t);a.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,o.skybox.material.reflectionTexture=a,i.isRGBD=!0,i.wrapU=BABYLON.Texture.CLAMP_ADDRESSMODE,i.wrapV=BABYLON.Texture.CLAMP_ADDRESSMODE,t.environmentBRDFTexture=i;var l=new BABYLON.ArcRotateCamera("camera",BABYLON.Tools.ToRadians(90),BABYLON.Tools.ToRadians(65),10,BABYLON.Vector3.Zero(),t);l.lowerRadiusLimit=10,l.upperRadiusLimit=40,l.lowerBetaLimit=.1,l.upperBetaLimit=Math.PI/2.2,l.panningDistanceLimit=0,l.attachControl(n,!0);var s=new BABYLON.DirectionalLight("light",new BABYLON.Vector3(0,-15,-5),t);return s.position=new BABYLON.Vector3(0,6,0),s.intensity=5,t}();window.scene=o,t([r,o])})));case 1:case"end":return t.stop()}}),t)})),r=function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function l(t){n(a,o,i,l,s,"next",t)}function s(t){n(a,o,i,l,s,"throw",t)}l(void 0)}))},r.apply(this,arguments)}const o='[Event "Norway Chess 2023"]\n[Site "Chess.com"]\n[Date "2023.06.09"]\n[Round "17"]\n[White "Nakamura, Hikaru"]\n[Black "Caruana, Fabiano"]\n[Result "1-0"]\n[WhiteElo "2775"]\n[BlackElo "2773"]\n[TimeControl "40/7200:0+10"]\n\n1. e4 {[%timestamp 30][%clk 1:59:57]} 1... e5 {[%timestamp 50][%clk 1:59:55]} 2.\nNf3 {[%timestamp 150][%clk 1:59:42]} 2... Nc6 {[%timestamp 60][%clk 1:59:49]} 3.\nBc4 {[%timestamp 100][%clk 1:59:32]} 3... Nf6 {[%timestamp 80][%clk 1:59:41]} 4.\nNg5 {[%timestamp 80][%clk 1:59:24]} 4... d5 {[%timestamp 150][%clk 1:59:26]} 5.\nexd5 {[%timestamp 110][%clk 1:59:13]} 5... Na5 {[%timestamp 120][%clk 1:59:14]}\n6. Bb5+ {[%timestamp 70][%clk 1:59:06]} 6... c6 {[%timestamp 50][%clk 1:59:09]}\n7. dxc6 {[%timestamp 40][%clk 1:59:02]} 7... bxc6 {[%timestamp 40][%clk\n1:59:05]} 8. Bd3 {[%timestamp 80][%clk 1:58:54]} 8... Nd5 {[%timestamp 360][%clk\n1:58:29]} 9. Nf3 {[%timestamp 60][%clk 1:58:48]} 9... Bd6 {[%timestamp 500][%clk\n1:57:39]} 10. O-O {[%timestamp 170][%clk 1:58:31]} 10... Nf4 {[%timestamp\n270][%clk 1:57:12]} 11. Nc3 {[%timestamp 80][%clk 1:58:23]} 11... Nxd3\n{[%timestamp 730][%clk 1:55:59]} 12. cxd3 {[%timestamp 60][%clk 1:58:17]} 12...\nO-O {[%timestamp 40][%clk 1:55:55]} 13. b3 {[%timestamp 40][%clk 1:58:13]} 13...\nRe8 {[%timestamp 2240][%clk 1:52:11]} 14. Re1 {[%timestamp 600][%clk 1:57:13]}\n14... c5 {[%timestamp 7960][%clk 1:38:55]} 15. Ba3 {[%timestamp 290][%clk\n1:56:44]} 15... Nc6 {[%timestamp 4950][%clk 1:30:40]} 16. Ne4 {[%timestamp\n730][%clk 1:55:31]} 16... Bf8 {[%timestamp 1400][%clk 1:28:20]} 17. Rc1\n{[%timestamp 260][%clk 1:55:05]} 17... f5 {[%timestamp 860][%clk 1:26:54]} 18.\nNxc5 {[%timestamp 13200][%clk 1:33:05]} 18... Qd5 {[%timestamp 19800][%clk\n0:53:54]} 19. Qc2 {[%timestamp 3210][%clk 1:27:44]} 19... Rd8 {[%timestamp\n3800][%clk 0:47:34]} 20. Qc4 {[%timestamp 6490][%clk 1:16:55]} 20... Qxc4\n{[%timestamp 50][%clk 0:47:29]} 21. Rxc4 {[%timestamp 160][%clk 1:16:39]} 21...\nRd5 {[%timestamp 50][%clk 0:47:24]} 22. Rec1 {[%timestamp 9610][%clk 1:00:38]}\n22... Bd6 {[%timestamp 2090][%clk 0:43:55]} 23. Bb2 {[%timestamp 3650][%clk\n0:54:33]} 23... Ne7 {[%timestamp 250][%clk 0:43:30]} 24. R4c2 {[%timestamp\n600][%clk 0:53:33]} 24... Rb8 {[%timestamp 5700][%clk 0:34:00]} 25. d4\n{[%timestamp 510][%clk 0:52:42]} 25... exd4 {[%timestamp 1510][%clk 0:31:29]}\n26. Nxd4 {[%timestamp 760][%clk 0:51:26]} 26... a5 {[%timestamp 260][%clk\n0:31:03]} 27. Nf3 {[%timestamp 3630][%clk 0:45:23]} 27... h6 {[%timestamp\n2140][%clk 0:27:29]} 28. Na4 {[%timestamp 7100][%clk 0:33:33]} 28... Ba6\n{[%timestamp 4670][%clk 0:19:42]} 29. Nc3 {[%timestamp 890][%clk 0:32:04]} 29...\nRc5 {[%timestamp 20][%clk 0:19:40]} 30. Ba3 {[%timestamp 550][%clk 0:31:09]}\n30... Rc6 {[%timestamp 140][%clk 0:19:26]} 31. Bxd6 {[%timestamp 380][%clk\n0:30:31]} 31... Rxd6 {[%timestamp 30][%clk 0:19:23]} 32. Na4 {[%timestamp\n130][%clk 0:30:18]} 32... Nd5 {[%timestamp 2450][%clk 0:15:18]} 33. Rc6\n{[%timestamp 2920][%clk 0:25:26]} 33... Rxc6 {[%timestamp 680][%clk 0:14:10]}\n34. Rxc6 {[%timestamp 110][%clk 0:25:15]} 34... Nb4 {[%timestamp 30][%clk\n0:14:07]} 35. Rd6 {[%timestamp 520][%clk 0:24:23]} 35... Bb7 {[%timestamp\n90][%clk 0:13:58]} 36. Nc3 {[%timestamp 2900][%clk 0:19:33]} 36... Re8\n{[%timestamp 520][%clk 0:13:06]} 37. h4 {[%timestamp 960][%clk 0:17:57]} 37...\nf4 {[%timestamp 820][%clk 0:11:44]} 38. Rd4 {[%timestamp 1410][%clk 0:15:36]}\n38... Rf8 {[%timestamp 1240][%clk 0:09:40]} 39. Ne5 {[%timestamp 980][%clk\n0:13:58]} 39... Re8 {[%timestamp 930][%clk 0:08:07]} 40. Nc4 {[%timestamp\n3050][%clk 0:08:53]} 40... f3 {[%timestamp 190][%clk 0:07:48]} 41. gxf3\n{[%timestamp 620][%clk 0:07:51]} 41... Bxf3 {[%timestamp 0][%clk 0:07:48]} 42.\nKh2 {[%timestamp 850][%clk 0:06:26]} 42... Nc2 {[%timestamp 870][%clk 0:06:21]}\n43. Rd3 {[%timestamp 380][%clk 0:05:48]} 43... Ba8 {[%timestamp 970][%clk\n0:04:44]} 44. Kg3 {[%timestamp 140][%clk 0:05:34]} 44... Kh7 {[%timestamp\n130][%clk 0:04:31]} 45. Ne3 {[%timestamp 50][%clk 0:05:29]} 45... Nb4\n{[%timestamp 860][%clk 0:03:05]} 46. Rd6 {[%timestamp -40][%clk 0:05:33]} 46...\nNc6 {[%timestamp 300][%clk 0:02:35]} 47. Ncd5 {[%timestamp 310][%clk 0:05:02]}\n47... Rf8 {[%timestamp 80][%clk 0:02:27]} 48. Nc7 {[%timestamp 870][%clk\n0:03:35]} 48... Bb7 {[%timestamp -80][%clk 0:02:35]} 49. Ne6 {[%timestamp\n230][%clk 0:03:12]} 49... Rf7 {[%timestamp -10][%clk 0:02:36]} 50. f4\n{[%timestamp 30][%clk 0:03:09]} 50... Ba8 {[%timestamp 250][%clk 0:02:11]} 51.\nh5 {[%timestamp 70][%clk 0:03:02]} 51... Ra7 {[%timestamp 850][%clk 0:00:46]}\n52. a3 {[%timestamp 20][%clk 0:03:00]} 52... Kg8 {[%timestamp 150][%clk\n0:00:31]} 53. f5 {[%timestamp 110][%clk 0:02:49]} 53... Re7 {[%timestamp\n140][%clk 0:00:17]} 54. Kf4 {[%timestamp 90][%clk 0:02:40]} 54... Ra7\n{[%timestamp 30][%clk 0:00:14]} 55. d4 {[%timestamp -10][%clk 0:02:41]} 1-0',i="Result";class a{constructor(t=""){this.clear();const e=t.match(/\[([^\]]+)]/g);if(e&&e.length>0)for(let t=0;t<e.length;t++){let n=e[t].match(/\[(\w+)\s+"([^"]+)"/);n&&(this.tags[n[1]]=n[2])}}clear(){this.tags={}}render(){let t="";for(const e in this.tags)t+=`[${e} "${this.tags[e]}"]\n`;return t}}function l(t,e,n,r){this.message=t,this.expected=e,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,l)}function s(t,e){e=void 0!==e?e:{};var n,r,o,i,a={},s={pgn:cn},c=cn,u=function(t,e){var n=e||[];return n.unshift(t),n},f=function(t,e){var n=e||[];return n.unshift(t),n},h=function(){return[[]]},p=function(t){return t},m=function(t){return t},v=function(t,e,n,r,o,i,a,l){var s=l||[],c={turn:"w"};return c.moveNumber=e,c.notation=r,c.commentBefore=n,c.commentAfter=i,c.commentMove=t,c.variations=a||[],c.nag=o||null,s.unshift(c),s},d=function(t,e,n,r,o,i,a,l){var s=l||[],c={turn:"b"};return c.moveNumber=e,c.notation=r,c.commentBefore=n,c.commentAfter=i,c.variations=a||[],s.unshift(c),c.nag=o||null,s},g="1:0",y=rn("1:0",!1),w=function(){return["1:0"]},b="0:1",A=rn("0:1",!1),k=function(){return["0:1"]},L="1-0",x=rn("1-0",!1),B=function(){return["1-0"]},N="0-1",O=rn("0-1",!1),E=function(){return["0-1"]},S="1/2-1/2",C=rn("1/2-1/2",!1),T=function(){return["1/2-1/2"]},_="*",P=rn("*",!1),I=function(){return["*"]},R=/^[^}]/,M=on(["}"],!0,!1),Y=function(t){return t.join("").trim()},j="{",G=rn("{",!1),D="}",F=rn("}",!1),U=function(t,e,n){var r=e||[];return r.unshift(t),r},$=function(t,e){var n=e||[];return n.unshift(t),n},K="(",Q=rn("(",!1),q=")",V=rn(")",!1),z=".",W=rn(".",!1),H=function(t){return t},Z={type:"other",description:"integer"},J=/^[0-9]/,X=on([["0","9"]],!1,!1),tt=function(t){return parseInt(t.join(""),10)},et=" ",nt=rn(" ",!1),rt=function(){return""},ot=function(t,e,n,r,o,i,a){var l={};return l.fig=t||null,l.disc=e||null,l.strike=n||null,l.col=r,l.row=o,l.check=a||null,l.promotion=i,l.notation=(t||"")+(e||"")+(n||"")+r+o+(i||"")+(a||""),l},it=function(t,e,n,r,o,i,a,l){var s={};return s.fig=t||null,s.strike="x"==r?r:null,s.col=o,s.row=i,s.check=l||null,s.notation=(t&&"P"!==t?t:"")+e+n+("x"==r?r:"-")+o+i+(a||"")+(l||""),s.promotion=a,s},at=function(t,e,n,r,o,i){var a={};return a.fig=t||null,a.strike=e||null,a.col=n,a.row=r,a.check=i||null,a.notation=(t||"")+(e||"")+n+r+(o||"")+(i||""),a.promotion=o,a},lt="O-O-O",st=rn("O-O-O",!1),ct=function(t){var e={};return e.notation="O-O-O"+(t||""),e.check=t||null,e},ut="O-O",ft=rn("O-O",!1),ht=function(t){var e={};return e.notation="O-O"+(t||""),e.check=t||null,e},pt="+-",mt=rn("+-",!1),vt="+",dt=rn("+",!1),gt=function(t){return t[1]},yt="$$$",wt=rn("$$$",!1),bt="#",At=rn("#",!1),kt="=",Lt=rn("=",!1),xt=function(t){return"="+t},Bt=function(t,e){var n=e||[];return n.unshift(t),n},Nt="$",Ot=rn("$",!1),Et=function(t){return"$"+t},St="!!",Ct=rn("!!",!1),Tt=function(){return"$3"},_t="??",Pt=rn("??",!1),It=function(){return"$4"},Rt="!?",Mt=rn("!?",!1),Yt=function(){return"$5"},jt="?!",Gt=rn("?!",!1),Dt=function(){return"$6"},Ft="!",Ut=rn("!",!1),$t=function(){return"$1"},Kt="?",Qt=rn("?",!1),qt=function(){return"$2"},Vt="‼",zt=rn("‼",!1),Wt="⁇",Ht=rn("⁇",!1),Zt="⁉",Jt=rn("⁉",!1),Xt="⁈",te=rn("⁈",!1),ee="□",ne=rn("□",!1),re=function(){return"$7"},oe=function(){return"$10"},ie="∞",ae=rn("∞",!1),le=function(){return"$13"},se="⩲",ce=rn("⩲",!1),ue=function(){return"$14"},fe="⩱",he=rn("⩱",!1),pe=function(){return"$15"},me="±",ve=rn("±",!1),de=function(){return"$16"},ge="∓",ye=rn("∓",!1),we=function(){return"$17"},be=function(){return"$18"},Ae="-+",ke=rn("-+",!1),Le=function(){return"$19"},xe="⨀",Be=rn("⨀",!1),Ne=function(){return"$22"},Oe="⟳",Ee=rn("⟳",!1),Se=function(){return"$32"},Ce="→",Te=rn("→",!1),_e=function(){return"$36"},Pe="↑",Ie=rn("↑",!1),Re=function(){return"$40"},Me="⇆",Ye=rn("⇆",!1),je=function(){return"$132"},Ge="D",De=rn("D",!1),Fe=function(){return"$220"},Ue=/^[RNBQKP]/,$e=on(["R","N","B","Q","K","P"],!1,!1),Ke=/^[a-h]/,Qe=on([["a","h"]],!1,!1),qe=/^[1-8]/,Ve=on([["1","8"]],!1,!1),ze="x",We=rn("x",!1),He="-",Ze=rn("-",!1),Je=0,Xe=[{line:1,column:1}],tn=0,en=[],nn=0;if("startRule"in e){if(!(e.startRule in s))throw new Error("Can't start parsing from rule \""+e.startRule+'".');c=s[e.startRule]}function rn(t,e){return{type:"literal",text:t,ignoreCase:e}}function on(t,e,n){return{type:"class",parts:t,inverted:e,ignoreCase:n}}function an(e){var n,r=Xe[e];if(r)return r;for(n=e-1;!Xe[n];)n--;for(r={line:(r=Xe[n]).line,column:r.column};n<e;)10===t.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return Xe[e]=r,r}function ln(t,e){var n=an(t),r=an(e);return{start:{offset:t,line:n.line,column:n.column},end:{offset:e,line:r.line,column:r.column}}}function sn(t){Je<tn||(Je>tn&&(tn=Je,en=[]),en.push(t))}function cn(){var t,e,n;return t=Je,(e=function(){var t;return Je,(t=fn())!==a&&(t=p(t)),t}())!==a?((n=hn())===a&&(n=null),n!==a?t=e=u(e,n):(Je=t,t=a)):(Je=t,t=a),t===a&&(t=Je,(e=un())!==a?((n=fn())===a&&(n=null),n!==a?t=e=f(e,n):(Je=t,t=a)):(Je=t,t=a),t===a&&(t=Je,(e=bn())===a&&(e=null),e!==a&&(e=h()),t=e)),t}function un(){var t;return Je,(t=hn())!==a&&(t=m(t)),t}function fn(){var e,n,r,o,i,l,s,c,u,f,h,p,m,d,g,y;return e=Je,(n=bn())===a&&(n=null),n!==a?((r=mn())===a&&(r=null),r!==a?((o=bn())===a&&(o=null),o!==a?(i=function(){var e,n,r;return e=Je,(n=wn())!==a?(46===t.charCodeAt(Je)?(r=z,Je++):(r=a,0===nn&&sn(W)),r===a&&(r=null),r!==a?e=n=H(n):(Je=e,e=a)):(Je=e,e=a),e}(),i===a&&(i=null),i!==a?((l=bn())===a&&(l=null),l!==a?((s=mn())===a&&(s=null),s!==a?((c=bn())===a&&(c=null),c!==a&&(u=An())!==a?((f=bn())===a&&(f=null),f!==a?((h=xn())===a&&(h=null),h!==a?((p=bn())===a&&(p=null),p!==a?((m=mn())===a&&(m=null),m!==a?((d=bn())===a&&(d=null),d!==a?((g=vn())===a&&(g=null),g!==a?((y=hn())===a&&(y=null),y!==a?e=n=v(r,i,s,u,h,m,g,y):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a),e===a&&(e=pn()),e}function hn(){var t,e,n,r,o,i,l,s,c,u,f,h,p,m,v,g;return t=Je,(e=bn())===a&&(e=null),e!==a?((n=mn())===a&&(n=null),n!==a?((r=bn())===a&&(r=null),r!==a?((o=Nn())===a&&(o=null),o!==a?((i=bn())===a&&(i=null),i!==a?((l=mn())===a&&(l=null),l!==a?((s=bn())===a&&(s=null),s!==a&&(c=An())!==a?((u=bn())===a&&(u=null),u!==a?((f=xn())===a&&(f=null),f!==a?((h=bn())===a&&(h=null),h!==a?((p=mn())===a&&(p=null),p!==a?((m=bn())===a&&(m=null),m!==a?((v=dn())===a&&(v=null),v!==a?((g=fn())===a&&(g=null),g!==a?t=e=d(n,o,l,c,f,p,v,g):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a),t===a&&(t=pn()),t}function pn(){var e,n;return e=Je,t.substr(Je,3)===g?(n=g,Je+=3):(n=a,0===nn&&sn(y)),n!==a&&(n=w()),(e=n)===a&&(e=Je,t.substr(Je,3)===b?(n=b,Je+=3):(n=a,0===nn&&sn(A)),n!==a&&(n=k()),(e=n)===a&&(e=Je,t.substr(Je,3)===L?(n=L,Je+=3):(n=a,0===nn&&sn(x)),n!==a&&(n=B()),(e=n)===a&&(e=Je,t.substr(Je,3)===N?(n=N,Je+=3):(n=a,0===nn&&sn(O)),n!==a&&(n=E()),(e=n)===a&&(e=Je,t.substr(Je,7)===S?(n=S,Je+=7):(n=a,0===nn&&sn(C)),n!==a&&(n=T()),(e=n)===a&&(e=Je,42===t.charCodeAt(Je)?(n=_,Je++):(n=a,0===nn&&sn(P)),n!==a&&(n=I()),e=n))))),e}function mn(){var e,n,r,o;if(e=Je,n=function(){var e;return 123===t.charCodeAt(Je)?(e=j,Je++):(e=a,0===nn&&sn(G)),e}(),n!==a){for(r=[],R.test(t.charAt(Je))?(o=t.charAt(Je),Je++):(o=a,0===nn&&sn(M));o!==a;)r.push(o),R.test(t.charAt(Je))?(o=t.charAt(Je),Je++):(o=a,0===nn&&sn(M));r!==a?(o=function(){var e;return 125===t.charCodeAt(Je)?(e=D,Je++):(e=a,0===nn&&sn(F)),e}(),o!==a?e=n=Y(r):(Je=e,e=a)):(Je=e,e=a)}else Je=e,e=a;return e}function vn(){var t,e,n,r,o,i;return t=Je,gn()!==a&&(e=fn())!==a&&yn()!==a?((n=bn())===a&&(n=null),n!==a?((r=vn())===a&&(r=null),r!==a?((o=bn())===a&&(o=null),o!==a?((i=Nn())===a&&(i=null),i!==a?t=U(e,r,i):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a),t}function dn(){var t,e,n,r;return t=Je,gn()!==a&&(e=un())!==a&&yn()!==a?((n=bn())===a&&(n=null),n!==a?((r=dn())===a&&(r=null),r!==a?t=$(e,r):(Je=t,t=a)):(Je=t,t=a)):(Je=t,t=a),t}function gn(){var e;return 40===t.charCodeAt(Je)?(e=K,Je++):(e=a,0===nn&&sn(Q)),e}function yn(){var e;return 41===t.charCodeAt(Je)?(e=q,Je++):(e=a,0===nn&&sn(V)),e}function wn(){var e,n,r;if(nn++,e=Je,n=[],J.test(t.charAt(Je))?(r=t.charAt(Je),Je++):(r=a,0===nn&&sn(X)),r!==a)for(;r!==a;)n.push(r),J.test(t.charAt(Je))?(r=t.charAt(Je),Je++):(r=a,0===nn&&sn(X));else n=a;return n!==a&&(n=tt(n)),nn--,(e=n)===a&&(n=a,0===nn&&sn(Z)),e}function bn(){var e,n;if(Je,e=[],32===t.charCodeAt(Je)?(n=et,Je++):(n=a,0===nn&&sn(nt)),n!==a)for(;n!==a;)e.push(n),32===t.charCodeAt(Je)?(n=et,Je++):(n=a,0===nn&&sn(nt));else e=a;return e!==a&&(e=rt()),e}function An(){var e,n,r,o,i,l,s,c,u;return e=Je,(n=On())===a&&(n=null),n!==a?(r=Je,nn++,o=function(){var t,e,n,r,o;return t=Je,(e=Bn())!==a?((n=Cn())===a&&(n=null),n!==a&&(r=En())!==a&&(o=Sn())!==a?t=e=[e,n,r,o]:(Je=t,t=a)):(Je=t,t=a),t}(),nn--,o!==a?(Je=r,r=void 0):r=a,r!==a&&(o=Bn())!==a?((i=Cn())===a&&(i=null),i!==a&&(l=En())!==a&&(s=Sn())!==a?((c=Ln())===a&&(c=null),c!==a?((u=kn())===a&&(u=null),u!==a?e=n=ot(n,o,i,l,s,c,u):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a),e===a&&(e=Je,(n=On())===a&&(n=null),n!==a&&(r=En())!==a&&(o=Sn())!==a?(i=function(){var e;return 120===t.charCodeAt(Je)?(e=ze,Je++):(e=a,0===nn&&sn(We)),e===a&&(45===t.charCodeAt(Je)?(e=He,Je++):(e=a,0===nn&&sn(Ze))),e}(),i===a&&(i=null),i!==a&&(l=En())!==a&&(s=Sn())!==a?((c=Ln())===a&&(c=null),c!==a?((u=kn())===a&&(u=null),u!==a?e=n=it(n,r,o,i,l,s,c,u):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a),e===a&&(e=Je,(n=On())===a&&(n=null),n!==a?((r=Cn())===a&&(r=null),r!==a&&(o=En())!==a&&(i=Sn())!==a?((l=Ln())===a&&(l=null),l!==a?((s=kn())===a&&(s=null),s!==a?e=n=at(n,r,o,i,l,s):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a),e===a&&(e=Je,t.substr(Je,5)===lt?(n=lt,Je+=5):(n=a,0===nn&&sn(st)),n!==a?((r=kn())===a&&(r=null),r!==a?e=n=ct(r):(Je=e,e=a)):(Je=e,e=a),e===a&&(e=Je,t.substr(Je,3)===ut?(n=ut,Je+=3):(n=a,0===nn&&sn(ft)),n!==a?((r=kn())===a&&(r=null),r!==a?e=n=ht(r):(Je=e,e=a)):(Je=e,e=a))))),e}function kn(){var e,n,r,o;return e=Je,n=Je,r=Je,nn++,t.substr(Je,2)===pt?(o=pt,Je+=2):(o=a,0===nn&&sn(mt)),nn--,o===a?r=void 0:(Je=r,r=a),r!==a?(43===t.charCodeAt(Je)?(o=vt,Je++):(o=a,0===nn&&sn(dt)),o!==a?n=r=[r,o]:(Je=n,n=a)):(Je=n,n=a),n!==a&&(n=gt(n)),(e=n)===a&&(e=Je,n=Je,r=Je,nn++,t.substr(Je,3)===yt?(o=yt,Je+=3):(o=a,0===nn&&sn(wt)),nn--,o===a?r=void 0:(Je=r,r=a),r!==a?(35===t.charCodeAt(Je)?(o=bt,Je++):(o=a,0===nn&&sn(At)),o!==a?n=r=[r,o]:(Je=n,n=a)):(Je=n,n=a),n!==a&&(n=gt(n)),e=n),e}function Ln(){var e,n,r;return e=Je,61===t.charCodeAt(Je)?(n=kt,Je++):(n=a,0===nn&&sn(Lt)),n!==a&&(r=On())!==a?e=n=xt(r):(Je=e,e=a),e}function xn(){var e,n,r,o;return e=Je,n=function(){var e,n,r;return e=Je,36===t.charCodeAt(Je)?(n=Nt,Je++):(n=a,0===nn&&sn(Ot)),n!==a&&(r=wn())!==a?e=n=Et(r):(Je=e,e=a),e===a&&(e=Je,t.substr(Je,2)===St?(n=St,Je+=2):(n=a,0===nn&&sn(Ct)),n!==a&&(n=Tt()),(e=n)===a&&(e=Je,t.substr(Je,2)===_t?(n=_t,Je+=2):(n=a,0===nn&&sn(Pt)),n!==a&&(n=It()),(e=n)===a&&(e=Je,t.substr(Je,2)===Rt?(n=Rt,Je+=2):(n=a,0===nn&&sn(Mt)),n!==a&&(n=Yt()),(e=n)===a&&(e=Je,t.substr(Je,2)===jt?(n=jt,Je+=2):(n=a,0===nn&&sn(Gt)),n!==a&&(n=Dt()),(e=n)===a&&(e=Je,33===t.charCodeAt(Je)?(n=Ft,Je++):(n=a,0===nn&&sn(Ut)),n!==a&&(n=$t()),(e=n)===a&&(e=Je,63===t.charCodeAt(Je)?(n=Kt,Je++):(n=a,0===nn&&sn(Qt)),n!==a&&(n=qt()),(e=n)===a&&(e=Je,8252===t.charCodeAt(Je)?(n=Vt,Je++):(n=a,0===nn&&sn(zt)),n!==a&&(n=Tt()),(e=n)===a&&(e=Je,8263===t.charCodeAt(Je)?(n=Wt,Je++):(n=a,0===nn&&sn(Ht)),n!==a&&(n=It()),(e=n)===a&&(e=Je,8265===t.charCodeAt(Je)?(n=Zt,Je++):(n=a,0===nn&&sn(Jt)),n!==a&&(n=Yt()),(e=n)===a&&(e=Je,8264===t.charCodeAt(Je)?(n=Xt,Je++):(n=a,0===nn&&sn(te)),n!==a&&(n=Dt()),(e=n)===a&&(e=Je,9633===t.charCodeAt(Je)?(n=ee,Je++):(n=a,0===nn&&sn(ne)),n!==a&&(n=re()),(e=n)===a&&(e=Je,61===t.charCodeAt(Je)?(n=kt,Je++):(n=a,0===nn&&sn(Lt)),n!==a&&(n=oe()),(e=n)===a&&(e=Je,8734===t.charCodeAt(Je)?(n=ie,Je++):(n=a,0===nn&&sn(ae)),n!==a&&(n=le()),(e=n)===a&&(e=Je,10866===t.charCodeAt(Je)?(n=se,Je++):(n=a,0===nn&&sn(ce)),n!==a&&(n=ue()),(e=n)===a&&(e=Je,10865===t.charCodeAt(Je)?(n=fe,Je++):(n=a,0===nn&&sn(he)),n!==a&&(n=pe()),(e=n)===a&&(e=Je,177===t.charCodeAt(Je)?(n=me,Je++):(n=a,0===nn&&sn(ve)),n!==a&&(n=de()),(e=n)===a&&(e=Je,8723===t.charCodeAt(Je)?(n=ge,Je++):(n=a,0===nn&&sn(ye)),n!==a&&(n=we()),(e=n)===a&&(e=Je,t.substr(Je,2)===pt?(n=pt,Je+=2):(n=a,0===nn&&sn(mt)),n!==a&&(n=be()),(e=n)===a&&(e=Je,t.substr(Je,2)===Ae?(n=Ae,Je+=2):(n=a,0===nn&&sn(ke)),n!==a&&(n=Le()),(e=n)===a&&(e=Je,10752===t.charCodeAt(Je)?(n=xe,Je++):(n=a,0===nn&&sn(Be)),n!==a&&(n=Ne()),(e=n)===a&&(e=Je,10227===t.charCodeAt(Je)?(n=Oe,Je++):(n=a,0===nn&&sn(Ee)),n!==a&&(n=Se()),(e=n)===a&&(e=Je,8594===t.charCodeAt(Je)?(n=Ce,Je++):(n=a,0===nn&&sn(Te)),n!==a&&(n=_e()),(e=n)===a&&(e=Je,8593===t.charCodeAt(Je)?(n=Pe,Je++):(n=a,0===nn&&sn(Ie)),n!==a&&(n=Re()),(e=n)===a&&(e=Je,8646===t.charCodeAt(Je)?(n=Me,Je++):(n=a,0===nn&&sn(Ye)),n!==a&&(n=je()),(e=n)===a&&(e=Je,68===t.charCodeAt(Je)?(n=Ge,Je++):(n=a,0===nn&&sn(De)),n!==a&&(n=Fe()),e=n))))))))))))))))))))))))),e}(),n!==a?((r=bn())===a&&(r=null),r!==a?((o=xn())===a&&(o=null),o!==a?e=n=Bt(n,o):(Je=e,e=a)):(Je=e,e=a)):(Je=e,e=a),e}function Bn(){var t;return(t=En())===a&&(t=Sn()),t}function Nn(){var e,n,r,o;if(e=Je,(n=wn())!==a){if(r=[],46===t.charCodeAt(Je)?(o=z,Je++):(o=a,0===nn&&sn(W)),o!==a)for(;o!==a;)r.push(o),46===t.charCodeAt(Je)?(o=z,Je++):(o=a,0===nn&&sn(W));else r=a;r!==a?e=n=H(n):(Je=e,e=a)}else Je=e,e=a;return e}function On(){var e;return Ue.test(t.charAt(Je))?(e=t.charAt(Je),Je++):(e=a,0===nn&&sn($e)),e}function En(){var e;return Ke.test(t.charAt(Je))?(e=t.charAt(Je),Je++):(e=a,0===nn&&sn(Qe)),e}function Sn(){var e;return qe.test(t.charAt(Je))?(e=t.charAt(Je),Je++):(e=a,0===nn&&sn(Ve)),e}function Cn(){var e;return 120===t.charCodeAt(Je)?(e=ze,Je++):(e=a,0===nn&&sn(We)),e}if((n=c())!==a&&Je===t.length)return n;throw n!==a&&Je<t.length&&sn({type:"end"}),r=en,o=tn<t.length?t.charAt(tn):null,i=tn<t.length?ln(tn,tn+1):ln(tn,tn),new l(l.buildMessage(r,o),r,o,i)}!function(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}(l,Error),l.buildMessage=function(t,e){var n={literal:function(t){return'"'+o(t.text)+'"'},class:function(t){var e,n="";for(e=0;e<t.parts.length;e++)n+=t.parts[e]instanceof Array?i(t.parts[e][0])+"-"+i(t.parts[e][1]):i(t.parts[e]);return"["+(t.inverted?"^":"")+n+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function r(t){return t.charCodeAt(0).toString(16).toUpperCase()}function o(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+r(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+r(t)}))}function i(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+r(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+r(t)}))}return"Expected "+function(t){var e,r,o,i=new Array(t.length);for(e=0;e<t.length;e++)i[e]=(o=t[e],n[o.type](o));if(i.sort(),i.length>0){for(e=1,r=1;e<i.length;e++)i[e-1]!==i[e]&&(i[r]=i[e],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(e)+" found."};class c{static parse(t,e){return s(t,e)}}const u="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",f=["1-0","0-1","1/2-1/2","*"],h={b:[16,32,17,15],w:[-16,-32,-17,-15]},p={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},m=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],v=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],d={p:0,n:1,b:2,r:3,q:4,k:5},g={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},y={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},w={w:[{square:y.a1,flag:g.QSIDE_CASTLE},{square:y.h1,flag:g.KSIDE_CASTLE}],b:[{square:y.a8,flag:g.QSIDE_CASTLE},{square:y.h8,flag:g.KSIDE_CASTLE}]};function b(t){var e=t.charAt(0);if(e>="a"&&e<="h"){if(t.match(/[a-h]\d.*[a-h]\d/))return;return T}return"o"===(e=e.toLowerCase())?P:e}function A(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function k(t){return t>>4}function L(t){return 15&t}function x(t){var e=L(t),n=k(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(n,n+1)}function B(t){return t===S?E:S}function N(t){var e=t instanceof Array?[]:{};for(var n in t)e[n]="object"==typeof n?N(t[n]):t[n];return e}function O(t){return t.replace(/^\s+|\s+$/g,"")}const E="b",S="w",C=-1,T="p",_="b",P="k",I=(function(){for(var t=[],e=y.a8;e<=y.h1;e++)136&e?e+=7:t.push(x(e))}(),{NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"}),R=function(t){var e=new Array(128),n={w:C,b:C},r=S,o={w:0,b:0},i=C,a=0,l=1,s=[],c={},R={};function M(t){void 0===t&&(t=!1),e=new Array(128),n={w:C,b:C},r=S,o={w:0,b:0},i=C,a=0,l=1,s=[],t||(c={}),R={},$(F())}function Y(){for(var t=[],e={},n=function(t){t in R&&(e[t]=R[t])};s.length>0;)t.push(rt());for(n(F());t.length>0;)nt(t.pop()),n(F());R=e}function j(){G(u)}function G(t,e){void 0===e&&(e=!1);var n=t.split(/\s+/),s=n[0],c=0;if(!D(t).valid)return!1;M(e);for(var u=0;u<s.length;u++){var f=s.charAt(u);if("/"===f)c+=8;else if(-1!=="0123456789".indexOf(f))c+=parseInt(f,10);else{var h=f<"a"?S:E;Q({type:f.toLowerCase(),color:h},x(c)),c++}}return r=n[1],n[2].indexOf("K")>-1&&(o.w|=g.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(o.w|=g.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(o.b|=g.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(o.b|=g.QSIDE_CASTLE),i="-"===n[3]?C:y[n[3]],a=parseInt(n[4],10),l=parseInt(n[5],10),$(F()),!0}function D(t){var e=t.split(/\s+/);if(6!==e.length)return{valid:!1,error_number:1,error:"FEN string must contain six space-delimited fields."};if(isNaN(parseInt(e[5]))||parseInt(e[5],10)<=0)return{valid:!1,error_number:2,error:"6th field (move number) must be a positive integer."};if(isNaN(parseInt(e[4]))||parseInt(e[4],10)<0)return{valid:!1,error_number:3,error:"5th field (half move counter) must be a non-negative integer."};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{valid:!1,error_number:4,error:"4th field (en-passant square) is invalid."};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(e[2]))return{valid:!1,error_number:5,error:"3rd field (castling availability) is invalid."};if(!/^(w|b)$/.test(e[1]))return{valid:!1,error_number:6,error:"2nd field (side to move) is invalid."};var n=e[0].split("/");if(8!==n.length)return{valid:!1,error_number:7,error:"1st field (piece positions) does not contain 8 '/'-delimited rows."};for(var r=0;r<n.length;r++){for(var o=0,i=!1,a=0;a<n[r].length;a++)if(isNaN(n[r][a])){if(!/^[prnbqkPRNBQK]$/.test(n[r][a]))return{valid:!1,error_number:9,error:"1st field (piece positions) is invalid [invalid piece]."};o+=1,i=!1}else{if(i)return{valid:!1,error_number:8,error:"1st field (piece positions) is invalid [consecutive numbers]."};o+=parseInt(n[r][a],10),i=!0}if(8!==o)return{valid:!1,error_number:10,error:"1st field (piece positions) is invalid [row too large]."}}return"3"==e[3][1]&&"w"==e[1]||"6"==e[3][1]&&"b"==e[1]?{valid:!1,error_number:11,error:"Illegal en-passant square"}:{valid:!0,error_number:0,error:"No errors."}}function F(){for(var t=0,n="",s=y.a8;s<=y.h1;s++){if(null==e[s])t++;else{t>0&&(n+=t,t=0);var c=e[s].color,u=e[s].type;n+=c===S?u.toUpperCase():u.toLowerCase()}s+1&136&&(t>0&&(n+=t),s!==y.h1&&(n+="/"),t=0,s+=8)}var f="";o[S]&g.KSIDE_CASTLE&&(f+="K"),o[S]&g.QSIDE_CASTLE&&(f+="Q"),o[E]&g.KSIDE_CASTLE&&(f+="k"),o[E]&g.QSIDE_CASTLE&&(f+="q"),f=f||"-";var h=i===C?"-":x(i);return[n,r,f,h,a,l].join(" ")}function U(t){for(var e=0;e<t.length;e+=2)"string"==typeof t[e]&&"string"==typeof t[e+1]&&(c[t[e]]=t[e+1]);return c}function $(t){s.length>0||(t!==u?(c.SetUp="1",c.FEN=t):(delete c.SetUp,delete c.FEN))}function K(t){var n=e[y[t]];return n?{type:n.type,color:n.color}:null}function Q(t,r){if(!("type"in t)||!("color"in t))return!1;if(-1==="pnbrqkPNBRQK".indexOf(t.type.toLowerCase()))return!1;if(!(r in y))return!1;var o=y[r];return(t.type!=P||n[t.color]==C||n[t.color]==o)&&(e[o]={type:t.type,color:t.color},t.type===P&&(n[t.color]=o),$(F()),!0)}function q(t,e,n,o,i){var a={color:r,from:e,to:n,flags:o,piece:t[e].type};return i&&(a.flags|=g.PROMOTION,a.promotion=i),t[n]?a.captured=t[n].type:o&g.EP_CAPTURE&&(a.captured=T),a}function V(t){function a(t,e,n,r,o){if(t[n].type!==T||0!==k(r)&&7!==k(r))e.push(q(t,n,r,o));else for(var i=["q","r",_,"n"],a=0,l=i.length;a<l;a++)e.push(q(t,n,r,o,i[a]))}var l=[],s=r,c=B(s),u={b:1,w:6},f=y.a8,m=y.h1,v=!1,d=void 0===t||!("legal"in t)||t.legal,w=void 0===t||!("piece"in t)||"string"!=typeof t.piece||t.piece.toLowerCase();if(void 0!==t&&"square"in t){if(!(t.square in y))return[];f=m=y[t.square],v=!0}for(var b=f;b<=m;b++)if(136&b)b+=7;else{var A=e[b];if(null!=A&&A.color===s)if(A.type!==T||!0!==w&&w!==T){if(!0===w||w===A.type)for(var L=0,x=p[A.type].length;L<x;L++){var N=p[A.type][L];for(O=b;!(136&(O+=N));){if(null!=e[O]){if(e[O].color===s)break;a(e,l,b,O,g.CAPTURE);break}if(a(e,l,b,O,g.NORMAL),"n"===A.type||"k"===A.type)break}}}else{var O=b+h[s][0];if(null==e[O]){a(e,l,b,O,g.NORMAL);O=b+h[s][1];u[s]===k(b)&&null==e[O]&&a(e,l,b,O,g.BIG_PAWN)}for(L=2;L<4;L++)136&(O=b+h[s][L])||(null!=e[O]&&e[O].color===c?a(e,l,b,O,g.CAPTURE):O===i&&a(e,l,b,i,g.EP_CAPTURE))}}if(!(!0!==w&&w!==P||v&&m!==n[s])){if(o[s]&g.KSIDE_CASTLE){var E=(S=n[s])+2;null!=e[S+1]||null!=e[E]||W(c,n[s])||W(c,S+1)||W(c,E)||a(e,l,n[s],E,g.KSIDE_CASTLE)}var S;if(o[s]&g.QSIDE_CASTLE)E=(S=n[s])-2,null!=e[S-1]||null!=e[S-2]||null!=e[S-3]||W(c,n[s])||W(c,S-1)||W(c,E)||a(e,l,n[s],E,g.QSIDE_CASTLE)}if(!d)return l;var C=[];for(b=0,x=l.length;b<x;b++)nt(l[b]),H(s)||C.push(l[b]),rt();return C}function z(t,e){var n="";if(t.flags&g.KSIDE_CASTLE)n="O-O";else if(t.flags&g.QSIDE_CASTLE)n="O-O-O";else{if(t.piece!==T){var r=function(t,e){for(var n=t.from,r=t.to,o=t.piece,i=0,a=0,l=0,s=0,c=e.length;s<c;s++){var u=e[s].from,f=e[s].to;o===e[s].piece&&n!==u&&r===f&&(i++,k(n)===k(u)&&a++,L(n)===L(u)&&l++)}return i>0?a>0&&l>0?x(n):l>0?x(n).charAt(1):x(n).charAt(0):""}(t,e);n+=t.piece.toUpperCase()+r}t.flags&(g.CAPTURE|g.EP_CAPTURE)&&(t.piece===T&&(n+=x(t.from)[0]),n+="x"),n+=x(t.to),t.flags&g.PROMOTION&&(n+="="+t.promotion.toUpperCase())}return nt(t),Z()&&(J()?n+="#":n+="+"),rt(),n}function W(t,n){for(var r=y.a8;r<=y.h1;r++)if(136&r)r+=7;else if(null!=e[r]&&e[r].color===t){var o=e[r],i=r-n,a=i+119;if(m[a]&1<<d[o.type]){if(o.type===T){if(i>0){if(o.color===S)return!0}else if(o.color===E)return!0;continue}if("n"===o.type||"k"===o.type)return!0;for(var l=v[a],s=r+l,c=!1;s!==n;){if(null!=e[s]){c=!0;break}s+=l}if(!c)return!0}}return!1}function H(t){return W(B(t),n[t])}function Z(){return H(r)}function J(){return Z()&&0===V().length}function X(){return!Z()&&0===V().length}function tt(){for(var t={},n=[],r=0,o=0,i=y.a8;i<=y.h1;i++)if(o=(o+1)%2,136&i)i+=7;else{var a=e[i];a&&(t[a.type]=a.type in t?t[a.type]+1:1,a.type===_&&n.push(o),r++)}if(2===r)return!0;if(3===r&&(1===t[_]||1===t.n))return!0;if(r===t[_]+2){var l=0,s=n.length;for(i=0;i<s;i++)l+=n[i];if(0===l||l===s)return!0}return!1}function et(){for(var t=[],e={},n=!1;;){var r=rt();if(!r)break;t.push(r)}for(;;){var o=F().split(" ").slice(0,4).join(" ");if(e[o]=o in e?e[o]+1:1,e[o]>=3&&(n=!0),!t.length)break;nt(t.pop())}return n}function nt(t){var c=r,u=B(c);if(function(t){s.push({move:t,kings:{b:n.b,w:n.w},turn:r,castling:{b:o.b,w:o.w},ep_square:i,half_moves:a,move_number:l})}(t),e[t.to]=e[t.from],e[t.from]=null,t.flags&g.EP_CAPTURE&&(r===E?e[t.to-16]=null:e[t.to+16]=null),t.flags&g.PROMOTION&&(e[t.to]={type:t.promotion,color:c}),e[t.to].type===P){if(n[e[t.to].color]=t.to,t.flags&g.KSIDE_CASTLE){var f=t.to-1,h=t.to+1;e[f]=e[h],e[h]=null}else t.flags&g.QSIDE_CASTLE&&(f=t.to+1,h=t.to-2,e[f]=e[h],e[h]=null);o[c]=""}if(o[c])for(var p=0,m=w[c].length;p<m;p++)if(t.from===w[c][p].square&&o[c]&w[c][p].flag){o[c]^=w[c][p].flag;break}if(o[u])for(p=0,m=w[u].length;p<m;p++)if(t.to===w[u][p].square&&o[u]&w[u][p].flag){o[u]^=w[u][p].flag;break}i=t.flags&g.BIG_PAWN?"b"===r?t.to-16:t.to+16:C,t.piece===T||t.flags&(g.CAPTURE|g.EP_CAPTURE)?a=0:a++,r===E&&l++,r=B(r)}function rt(){var t=s.pop();if(null==t)return null;var c=t.move;n=t.kings,r=t.turn,o=t.castling,i=t.ep_square,a=t.half_moves,l=t.move_number;var u,f,h=r,p=B(r);if(e[c.from]=e[c.to],e[c.from].type=c.piece,e[c.to]=null,c.flags&g.CAPTURE)e[c.to]={type:c.captured,color:p};else if(c.flags&g.EP_CAPTURE){var m;m=h===E?c.to-16:c.to+16,e[m]={type:T,color:p}}return c.flags&(g.KSIDE_CASTLE|g.QSIDE_CASTLE)&&(c.flags&g.KSIDE_CASTLE?(u=c.to+1,f=c.to-1):c.flags&g.QSIDE_CASTLE&&(u=c.to-2,f=c.to+1),e[u]=e[f],e[f]=null),c}function ot(t,e){for(var n=A(t),r=0;r<2;r++){if(1==r){if(!e)return null;var o=!1;if(c=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/)){var i=c[1],a=c[2],l=c[3],s=c[4];1==a.length&&(o=!0)}else{var c;(c=n.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/))&&(i=c[1],a=c[2],l=c[3],s=c[4],1==a.length&&(o=!0))}}for(var u=b(n),f=V({legal:!0,piece:i||u}),h=0,p=f.length;h<p;h++)switch(r){case 0:if(n===A(z(f[h],f)))return f[h];break;case 1:if(c){if(!(i&&i.toLowerCase()!=f[h].piece||y[a]!=f[h].from||y[l]!=f[h].to||s&&s.toLowerCase()!=f[h].promotion))return f[h];if(o){var m=x(f[h].from);if(!(i&&i.toLowerCase()!=f[h].piece||y[l]!=f[h].to||a!=m[0]&&a!=m[1]||s&&s.toLowerCase()!=f[h].promotion))return f[h]}}}}return null}function it(t){var e=N(t);e.san=z(e,V({legal:!0})),e.to=x(e.to),e.from=x(e.from);var n="";for(var r in g)g[r]&e.flags&&(n+=I[r]);return e.flags=n,e}function at(t){for(var e=V({legal:!1}),n=0,o=r,i=0,a=e.length;i<a;i++)nt(e[i]),H(o)||(t-1>0?n+=at(t-1):n++),rt();return n}return G(void 0===t?u:t),{load:function(t){return G(t)},reset:function(){return j()},moves:function(t){for(var e=V(t),n=[],r=0,o=e.length;r<o;r++)void 0!==t&&"verbose"in t&&t.verbose?n.push(it(e[r])):n.push(z(e[r],V({legal:!0})));return n},in_check:function(){return Z()},in_checkmate:function(){return J()},in_stalemate:function(){return X()},in_draw:function(){return a>=100||X()||tt()||et()},insufficient_material:function(){return tt()},in_threefold_repetition:function(){return et()},game_over:function(){return a>=100||J()||X()||tt()||et()},validate_fen:function(t){return D(t)},fen:function(){return F()},board:function(){for(var t=[],n=[],r=y.a8;r<=y.h1;r++)null==e[r]?n.push(null):n.push({square:x(r),type:e[r].type,color:e[r].color}),r+1&136&&(t.push(n),n=[],r+=8);return t},pgn:function(t){var e="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\n",n="object"==typeof t&&"number"==typeof t.max_width?t.max_width:0,r=[],o=!1;for(var i in c)r.push("["+i+' "'+c[i]+'"]'+e),o=!0;o&&s.length&&r.push(e);for(var a=function(t){var e=R[F()];return void 0!==e&&(t=`${t}${t.length>0?" ":""}{${e}}`),t},u=[];s.length>0;)u.push(rt());var f=[],h="";for(0===u.length&&f.push(a(""));u.length>0;){h=a(h);var p=u.pop();if(s.length||"b"!==p.color)"w"===p.color&&(h.length&&f.push(h),h=l+".");else{const t=`${l}. ...`;h=h?`${h} ${t}`:t}h=h+" "+z(p,V({legal:!0})),nt(p)}if(h.length&&f.push(a(h)),void 0!==c.Result&&f.push(c.Result),0===n)return r.join("")+f.join(" ");var m=function(){return r.length>0&&" "===r[r.length-1]&&(r.pop(),!0)},v=function(t,o){for(var i of o.split(" "))if(i){if(t+i.length>n){for(;m();)t--;r.push(e),t=0}r.push(i),t+=i.length,r.push(" "),t++}return m()&&t--,t},d=0;for(i=0;i<f.length;i++)d+f[i].length>n&&f[i].includes("{")?d=v(d,f[i]):(d+f[i].length>n&&0!==i?(" "===r[r.length-1]&&r.pop(),r.push(e),d=0):0!==i&&(r.push(" "),d++),r.push(f[i]),d+=f[i].length);return r.join("")},load_pgn:function(t,e){var n=void 0!==e&&"sloppy"in e&&e.sloppy;function r(t){return t.replace(/\\/g,"\\")}t=t.trim();var o="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",i=new RegExp("^(\\[((?:"+r(o)+")|.)*\\])(?:\\s*"+r(o)+"){2}"),a=i.test(t)?i.exec(t)[1]:"";j();var l=function(t,e){for(var n="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",o={},i=t.split(new RegExp(r(n))),a="",l="",s=0;s<i.length;s++){var c=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;a=i[s].replace(c,"$1"),l=i[s].replace(c,"$2"),O(a).length>0&&(o[a]=l)}return o}(a,e),s="";for(var u in l)"fen"===u.toLowerCase()&&(s=l[u]),U([u,l[u]]);if(n){if(s&&!G(s,!0))return!1}else if(!("1"!==l.SetUp||"FEN"in l&&G(l.FEN,!0)))return!1;for(var h=function(t){return`{${function(t){return Array.from(t).map((function(t){return t.charCodeAt(0)<128?t.charCodeAt(0).toString(16):encodeURIComponent(t).replace(/\%/g,"").toLowerCase()})).join("")}((t=t.replace(new RegExp(r(o),"g")," ")).slice(1,t.length-1))}}`},p=function(t){if(t.startsWith("{")&&t.endsWith("}"))return function(t){return 0==t.length?"":decodeURIComponent("%"+t.match(/.{1,2}/g).join("%"))}(t.slice(1,t.length-1))},m=t.replace(a,"").replace(new RegExp(`({[^}]*})+?|;([^${r(o)}]*)`,"g"),(function(t,e,n){return void 0!==e?h(e):" "+h(`{${n.slice(1)}}`)})).replace(new RegExp(r(o),"g")," "),v=/(\([^\(\)]+\))+?/g;v.test(m);)m=m.replace(v,"");var d=O(m=(m=(m=m.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));d=d.join(",").replace(/,,+/g,",").split(",");for(var g="",y="",w=0;w<d.length;w++){var b=p(d[w]);if(void 0===b)if(null==(g=ot(d[w],n))){if(!(f.indexOf(d[w])>-1))return!1;y=d[w]}else y="",nt(g);else R[F()]=b}return y&&Object.keys(c).length&&!c.Result&&U(["Result",y]),!0},header:function(){return U(arguments)},turn:function(){return r},move:function(t,e){var n=void 0!==e&&"sloppy"in e&&e.sloppy,r=null;if("string"==typeof t)r=ot(t,n);else if("object"==typeof t)for(var o=V(),i=0,a=o.length;i<a;i++)if(t.from===x(o[i].from)&&t.to===x(o[i].to)&&(!("promotion"in o[i])||t.promotion===o[i].promotion)){r=o[i];break}if(!r)return null;var l=it(r);return nt(r),l},undo:function(){var t=rt();return t?it(t):null},clear:function(){return M()},put:function(t,e){return Q(t,e)},get:function(t){return K(t)},ascii(){for(var t="   +------------------------+\n",n=y.a8;n<=y.h1;n++){if(0===L(n)&&(t+=" "+"87654321"[k(n)]+" |"),null==e[n])t+=" . ";else{var r=e[n].type;t+=" "+(e[n].color===S?r.toUpperCase():r.toLowerCase())+" "}n+1&136&&(t+="|\n",n+=8)}return(t+="   +------------------------+\n")+"     a  b  c  d  e  f  g  h"},remove:function(t){return function(t){var r=K(t);return e[y[t]]=null,r&&r.type===P&&(n[r.color]=C),$(F()),r}(t)},perft:function(t){return at(t)},square_color:function(t){if(t in y){var e=y[t];return(k(e)+L(e))%2==0?"light":"dark"}return null},history:function(t){for(var e=[],n=[],r=(void 0!==t&&"verbose"in t&&t.verbose);s.length>0;)e.push(rt());for(;e.length>0;){var o=e.pop();r?n.push(it(o)):n.push(z(o,V({legal:!0}))),nt(o)}return n},get_comment:function(){return R[F()]},set_comment:function(t){R[F()]=t.replace("{","[").replace("}","]")},delete_comment:function(){var t=R[F()];return delete R[F()],t},get_comments:function(){return Y(),Object.keys(R).map((function(t){return{fen:t,comment:R[t]}}))},delete_comments:function(){return Y(),Object.keys(R).map((function(t){var e=R[t];return delete R[t],{fen:t,comment:e}}))}}};function M(t,e){this.fen=t,this.notation=e,this.toString=function(){return"IllegalMoveException: "+t+" => "+e}}class Y{constructor(t=null,e=null,n=!1){if(t){const r=c.parse(t.replace(/\s\s+/g," ").replace(/\n/g," "));this.moves=this.traverse(r[0],e,null,1,n)}else this.clear();this.setUpFen=e}clear(){this.moves=[]}traverse(t,e,n=null,r=1,o=!1){const i=e?new R(e):new R,a=[];let l=n;for(let n of t){if(n.notation){const t=n.notation.notation,s=i.move(t,{sloppy:o});if(!s)throw new M(i.fen(),t);{l?(s.previous=l,l.next=s):s.previous=null,s.ply=r,this.fillMoveFromChessState(s,i),n.nag&&(s.nag=n.nag[0]),n.commentBefore&&(s.commentBefore=n.commentBefore),n.commentMove&&(s.commentMove=n.commentMove),n.commentAfter&&(s.commentAfter=n.commentAfter),s.variations=[];const t=n.variations;if(t.length>0){const n=a.length>0?a[a.length-1].fen:e;for(let e of t)s.variations.push(this.traverse(e,n,l,r,o))}s.variation=a,a.push(s),l=s}}r++}return a}fillMoveFromChessState(t,e){t.fen=e.fen(),t.uci=t.from+t.to+(t.promotion?t.promotion:""),t.variations=[],e.game_over()&&(t.gameOver=!0,e.in_draw()&&(t.inDraw=!0),e.in_stalemate()&&(t.inStalemate=!0),e.insufficient_material()&&(t.insufficientMaterial=!0),e.in_threefold_repetition()&&(t.inThreefoldRepetition=!0),e.in_checkmate()&&(t.inCheckmate=!0)),e.in_check()&&(t.inCheck=!0)}historyToMove(t){const e=[];let n=t;for(e.push(n);n.previous;)e.push(n.previous),n=n.previous;return e.reverse()}validateMove(t,e=null,n=!0){e||this.moves.length>0&&(e=this.moves[this.moves.length-1]);const r=new R(this.setUpFen?this.setUpFen:void 0);if(e){const t=this.historyToMove(e);for(const e of t)r.move(e)}const o=r.move(t,{sloppy:n});return o&&this.fillMoveFromChessState(o,r),o}addMove(t,e=null,n=!0){e||this.moves.length>0&&(e=this.moves[this.moves.length-1]);const r=this.validateMove(t,e,n);if(!r)throw new Error("invalid move");return r.previous=e,e?(r.ply=e.ply+1,r.uci=r.from+r.to+(r.promotion?r.promotion:""),e.next?(e.next.variations.push([]),r.variation=e.next.variations[e.next.variations.length-1],r.variation.push(r)):(e.next=r,r.variation=e.variation,e.variation.push(r))):(r.variation=this.moves,r.ply=1,this.moves.push(r)),r}render(t=!0,e=!0){const n=(r,o=!1)=>{let i="";for(let a of r){if(a.ply%2==1?i+=Math.floor(a.ply/2)+1+". ":(0===i.length||o)&&(i+=a.ply/2+"... "),o=!1,e&&a.nag&&(i+="$"+a.nag+" "),t&&a.commentBefore&&(i+="{"+a.commentBefore+"} ",o=!0),i+=a.san+" ",t&&a.commentMove&&(i+="{"+a.commentMove+"} ",o=!0),t&&a.commentAfter&&(i+="{"+a.commentAfter+"} ",o=!0),a.variations.length>0)for(let t of a.variations)i+="("+n(t)+") ",o=!0;i+=" "}return i};let r=n(this.moves);return r=r.replace(/\s+\)/g,")"),r=r.replace(/\s\s+/g," ").trim(),r}}class j{constructor(t="",e={}){const n="]"===t.trim().slice(-1)?t.length:t.lastIndexOf("]\n\n")+1,r=t.substring(0,n),o=t.substring(n),i=!!e.sloppy;this.header=new a(r),"1"===this.header.tags.SetUp&&this.header.tags.FEN?this.history=new Y(o,this.header.tags.FEN,i):this.history=new Y(o,null,i)}wrap(t,e){const n=t.split(" ");let r=[],o="";for(let t=0;t<n.length;t++){const i=n[t];o.length+i.length<e?o+=i+" ":(r.push(o.trim()),o=i+" ")}return r.push(o.trim()),r.join("\n")}render(t=!0,e=!0,n=!0){const r=t?this.header.render()+"\n":"";let o=this.history.render(e,n);return this.header.tags[i]&&(o+=" "+this.header.tags[i]),r+this.wrap(o,80)}}function G(t){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G(t)}function D(){D=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function c(t,e,n,o){var i=e&&e.prototype instanceof h?e:h,a=Object.create(i.prototype),l=new B(o||[]);return r(a,"_invoke",{value:A(t,n,l)}),a}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var f={};function h(){}function p(){}function m(){}var v={};s(v,i,(function(){return this}));var d=Object.getPrototypeOf,g=d&&d(d(N([])));g&&g!==e&&n.call(g,i)&&(v=g);var y=m.prototype=h.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function o(r,i,a,l){var s=u(t[r],t,i);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==G(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,a,l)}),(function(t){o("throw",t,a,l)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return o("throw",t,a,l)}))}l(s.arg)}var i;r(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,r){o(t,n,e,r)}))}return i=i?i.then(r,r):r()}})}function A(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var l=k(a,n);if(l){if(l===f)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}function k(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var o=u(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function B(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function N(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return p.prototype=m,r(y,"constructor",{value:m,configurable:!0}),r(m,"constructor",{value:p,configurable:!0}),p.displayName=s(m,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,l,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},w(b.prototype),s(b.prototype,a,(function(){return this})),t.AsyncIterator=b,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new b(c(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(y),s(y,l,"Generator"),s(y,i,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=N,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(l&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;x(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:N(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function F(t,e,n,r,o,i,a){try{var l=t[i](a),s=l.value}catch(t){return void n(t)}l.done?e(s):Promise.resolve(s).then(r,o)}function U(){return $.apply(this,arguments)}function $(){var t;return t=D().mark((function t(){return D().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){var n=new BABYLON.AssetsManager(scene),r=new BABYLON.AssetContainer(scene),o=new BABYLON.Vector3(.006,.006,.006),i=n.addMeshTask("Sword","Sword","./assets/","weapons.babylon"),a=n.addMeshTask("Scepter","Scepter","./assets/","weapons.babylon"),l=n.addMeshTask("Shield","Shield","./assets/","weapons.babylon"),s=n.addMeshTask("Staff","Staff","./assets/","weapons.babylon"),c=n.addMeshTask("Spear","Spear","./assets/","weapons.babylon"),u=n.addMeshTask("Board","","./assets/","chessboard.babylon"),f=n.addMeshTask("Pawn","","./assets/","pawn.babylon"),h=n.addMeshTask("Bishop","","./assets/","bishop.babylon"),p=n.addMeshTask("Knight","","./assets/","knight.babylon"),m=n.addMeshTask("Rook","","./assets/","rook.babylon"),v=n.addMeshTask("Queen","","./assets/","queen.babylon"),d=n.addMeshTask("King","","./assets/","king.babylon");i.onSuccess=function(t){var e=t.loadedMeshes[0];e.parent=null,e.name="Sword",r.meshes.push(e)},a.onSuccess=function(t){var e=t.loadedMeshes[0];e.parent=null,e.name="Scepter",r.meshes.push(e)},l.onSuccess=function(t){var e=t.loadedMeshes[0];e.parent=null,e.name="Shield",r.meshes.push(e)},s.onSuccess=function(t){var e=t.loadedMeshes[0];e.parent=null,e.name="Staff",r.meshes.push(e)},c.onSuccess=function(t){var e=t.loadedMeshes[0];e.parent=null,e.name="Spear",r.meshes.push(e)},u.onSuccess=function(t){var e=t.loadedMeshes[0],n=t.loadedMeshes[1];e.parent=null,e.name="BoardDecoration",n.parent=null,n.name="Board",r.meshes.push(e),r.meshes.push(n)},f.onSuccess=function(t){var e=t.loadedSkeletons[0],n=t.loadedMeshes[0];n.scaling=o,e.scaling=o,r.meshes.push(n,e)},p.onSuccess=function(t){var e=t.loadedSkeletons[0],n=t.loadedMeshes[0];n.scaling=o,e.scaling=o,r.meshes.push(n)},h.onSuccess=function(t){var e=t.loadedSkeletons[0],n=t.loadedMeshes[0];n.scaling=o,e.scaling=o,r.meshes.push(n)},m.onSuccess=function(t){var e=t.loadedSkeletons[0],n=t.loadedMeshes[0];n.scaling=o,e.scaling=o,r.meshes.push(n)},v.onSuccess=function(t){var e=t.loadedSkeletons[0],n=t.loadedMeshes[0];n.scaling=o,e.scaling=o,r.meshes.push(n)},d.onSuccess=function(t){var e=t.loadedSkeletons[0],n=t.loadedMeshes[0];n.scaling=o,e.scaling=o,r.meshes.push(n)},n.onFinish=function(e){r.removeAllFromScene(),t(r)},n.load()})));case 1:case"end":return t.stop()}}),t)})),$=function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){F(i,r,o,a,l,"next",t)}function l(t){F(i,r,o,a,l,"throw",t)}a(void 0)}))},$.apply(this,arguments)}function K(t){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(t)}function Q(){Q=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function c(t,e,n,o){var i=e&&e.prototype instanceof h?e:h,a=Object.create(i.prototype),l=new B(o||[]);return r(a,"_invoke",{value:A(t,n,l)}),a}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var f={};function h(){}function p(){}function m(){}var v={};s(v,i,(function(){return this}));var d=Object.getPrototypeOf,g=d&&d(d(N([])));g&&g!==e&&n.call(g,i)&&(v=g);var y=m.prototype=h.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function o(r,i,a,l){var s=u(t[r],t,i);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==K(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,a,l)}),(function(t){o("throw",t,a,l)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return o("throw",t,a,l)}))}l(s.arg)}var i;r(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,r){o(t,n,e,r)}))}return i=i?i.then(r,r):r()}})}function A(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var l=k(a,n);if(l){if(l===f)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}function k(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var o=u(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function B(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function N(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return p.prototype=m,r(y,"constructor",{value:m,configurable:!0}),r(m,"constructor",{value:p,configurable:!0}),p.displayName=s(m,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,l,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},w(b.prototype),s(b.prototype,a,(function(){return this})),t.AsyncIterator=b,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new b(c(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(y),s(y,l,"Generator"),s(y,i,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=N,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(l&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;x(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:N(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function q(t,e,n,r,o,i,a){try{var l=t[i](a),s=l.value}catch(t){return void n(t)}l.done?e(s):Promise.resolve(s).then(r,o)}function V(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){q(i,r,o,a,l,"next",t)}function l(t){q(i,r,o,a,l,"throw",t)}a(void 0)}))}}var z=-1,W=-1,H=null,Z=null,J=null,X=!1,tt=1;function et(t){var e=Z.meshes.slice();if(-1==t)var n=ft("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1");else n=ft(H.history.moves[t].fen);for(var r=0;r<8;r++)for(var o=0;o<8;o++)for(var i=0;i<e.length;i++)if(e[i].piece==n[r][o]){e[i].parent.position=rt(String.fromCharCode(97+o)+(8-r)),e[i].piecePosition.coordinate=String.fromCharCode(97+o)+(8-r),e[i].piecePosition.x=o,e[i].piecePosition.y=r,e[i].isVisible=!0,null!=e[i].weapon&&(e[i].weapon.isVisible=!0),scene.stopAnimation(e[i].skeleton);var a=e[i].skeleton.getAnimationRange("Idle");scene.beginAnimation(e[i].skeleton,a.from,a.to,!0,1),e.splice(i,1);break}z=W,X=!1}function nt(t){var e=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("whiteFlashTexture"),n=new BABYLON.GUI.Rectangle;n.width=1,n.height=1,n.background="white",n.alpha=0,n.isPointerBlocker=!0,e.addControl(n);var r=[];r.push({frame:0,value:0}),r.push({frame:10,value:1}),r.push({frame:20,value:0});var o=new BABYLON.Animation("whiteFlash","alpha",60,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);return o.setKeys(r),n.animations=[],n.animations.push(o),scene.beginAnimation(n,0,20,!1,1,(function(){e.dispose()})),new Promise((function(e){setTimeout(e,t)}))}function rt(t){for(var e=0;e<J.length;e++)for(var n=0;n<J[e].length;n++)if(J[e][n][1]==t)return J[e][n][0]}function ot(t,e){return it.apply(this,arguments)}function it(){return(it=V(Q().mark((function t(e,n){var r,o,i,a,l,s,c,u,f,h,p,m;return Q().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Starting attack"),r=engine.getFps(),o=e.skeleton.getAnimationRange("Attack"),i=n.skeleton.getAnimationRange("Death"),a=tt,l=r/(o.to-o.from)/a,s=e.parent.position,c=n.parent.position,ct(e.parent,n.parent.position),"n"!=e.name.charAt(1)&&"r"!=e.name.charAt(1)||(u=new BABYLON.Animation("moveAnimation","position",r,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),(f=[]).push({frame:0,value:s}),f.push({frame:a*r,value:c}),u.setKeys(f),e.parent.animations.push(u),scene.beginAnimation(e.parent,0,a*r,!1,1)),h=scene.beginAnimation(e.skeleton,o.from,o.to,!1,l),scene.beginAnimation(n.skeleton,i.from,i.to,!1,l),p=1e3/r*(o.to-o.from)*a,t.next=16,new Promise((function(t){return setTimeout(t,p/2)}));case 16:return nt(500),t.next=19,h.waitAsync();case 19:"n"!=e.name.charAt(1)&&"r"!=e.name.charAt(1)||(scene.stopAnimation(e),scene.stopAnimation(e.skeleton),e.parent.rotation.y=0,m=e.skeleton.getAnimationRange("Idle"),scene.beginAnimation(e.skeleton,m.from,m.to,!0,1),ht(z+1)),null!=n.weapon&&(n.weapon.isVisible=!1),n.isVisible=!1,n.piecePosition.coordinate=null,"n"!=e.name.charAt(1)&&"r"!=e.name.charAt(1)||(X=!1),console.log("Attack Anim over");case 25:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function at(t,e){t.piecePosition.coordinate=e}function lt(t,e,n,r){return st.apply(this,arguments)}function st(){return(st=V(Q().mark((function t(e,n,r,o){var i,a,l,s,c,u,f,h,p,m,v,d,g;return Q().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Starting move to"),ct(e.parent,r),i=e.parent,l=!0,s=1,c=engine.getFps().toFixed(),u=tt,f=n,h=r,console.log("Current FPS: "+engine.getFps().toFixed()),"n"==e.name.charAt(1)?(a=e.skeleton.getAnimationRange("Jump"),l=!1):a=e.skeleton.getAnimationRange("Walk"),console.log("from:"+a.from+",to:"+a.to),0==l?(s=c/(a.to-a.from)/u,console.log("animationSpeed:"+s)):(p=BABYLON.Vector3.Distance(n,r),s*=p/1.5/u),m=new BABYLON.Animation("moveAnimation","position",c,BABYLON.Animation.ANIMATIONTYPE_VECTOR3,BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT),(v=[]).push({frame:0,value:f}),v.push({frame:u*c,value:h}),m.setKeys(v),i.animations.push(m),d=scene.beginAnimation(i,0,u*c,!1,1),scene.stopAnimation(e.skeleton),scene.beginAnimation(e.skeleton,a.from,a.to,l,s),t.next=24,d.waitAsync();case 24:console.log("Move Anim over"),scene.stopAnimation(e),scene.stopAnimation(e.skeleton),e.parent.rotation.y=0,g=e.skeleton.getAnimationRange("Idle"),scene.beginAnimation(e.skeleton,g.from,g.to,!0,1),o||(ht(z+1),X=!1);case 31:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ct(t,e){var n=e.subtract(t.position);t.rotation.y=Math.atan2(n.x,n.z),"b"==t.getChildren()[0].name.charAt(0)?t.rotation.y-=BABYLON.Tools.ToRadians(90):t.rotation.y+=BABYLON.Tools.ToRadians(90)}function ut(){return(ut=V(Q().mark((function t(e){var n,r,o,i,a,l,s,c;return Q().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=H.history.moves[e],console.log("Moving piece:"+n.from),null==n){t.next=38;break}for(r=null,o=null,console.log("Container:"+Z.meshes),i=0;i<Z.meshes.length;i++)Z.meshes[i].piecePosition.coordinate==n.from&&(r=Z.meshes[i]),Z.meshes[i].piecePosition.coordinate==n.to&&(o=Z.meshes[i]);if(console.log("flag: "+n.flags),console.log("frommesh: "+r),"c"!=n.flags){t.next=19;break}return a=rt(n.to),t.next=13,ot(r,o);case 13:if("n"==r.name.charAt(1)||"r"==r.name.charAt(1)){t.next=16;break}return t.next=16,lt(r,r.parent.position,a,!1);case 16:at(r,n.to),t.next=38;break;case 19:if("n"!=n.flags&&"b"!=n.flags){t.next=26;break}return a=rt(n.to),t.next=23,lt(r,r.parent.position,a,!1);case 23:at(r,n.to),t.next=38;break;case 26:if("k"!=n.flags&&"q"!=n.flags){t.next=38;break}if(l=null,s=null,c=null,"k"==n.flags)for(i=0;i<Z.meshes.length;i++)Z.meshes[i].piecePosition.coordinate=="h"+r.piecePosition.coordinate.charAt(1)&&(l=Z.meshes[i],s="f"+l.piecePosition.coordinate.charAt(1),c=rt(s));else for(i=0;i<Z.meshes.length;i++)Z.meshes[i].piecePosition.coordinate=="a"+r.piecePosition.coordinate.charAt(1)&&(l=Z.meshes[i],s="d"+l.piecePosition.coordinate.charAt(1),c=rt(s));return t.next=33,lt(l,l.parent.position,c,!0);case 33:return a=rt(n.to),t.next=36,lt(r,r.parent.position,a,!1);case 36:at(r,n.to),at(l,s);case 38:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ft(t){for(var e=[["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""]],n=t.split("/",8),r=0;r<n.length;r++)for(var o=0,i=0;i<n[r].length&&" "!=n[r].charAt(i);i++)if(isNaN(n[r].charAt(i)+1))n[r].charAt(i).toUpperCase()==n[r].charAt(i)?(e[r][o]="w"+n[r].charAt(i).toLowerCase(),o+=1):(e[r][o]="b"+n[r].charAt(i),o+=1);else for(var a=0;a<n[r].charAt(i);a++)e[r][o]="em",o+=1;return e}function ht(t){z=t}function pt(){console.log("Refreshing. Current move: "+z+", Required move: "+W+", Move in progress: "+X),z<W&&!X?(function(t){ut.apply(this,arguments)}(z+1),X=!0):z>W&&!X&&(X=!0,et(W))}function mt(t){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mt(t)}function vt(){vt=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function c(t,e,n,o){var i=e&&e.prototype instanceof h?e:h,a=Object.create(i.prototype),l=new B(o||[]);return r(a,"_invoke",{value:A(t,n,l)}),a}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var f={};function h(){}function p(){}function m(){}var v={};s(v,i,(function(){return this}));var d=Object.getPrototypeOf,g=d&&d(d(N([])));g&&g!==e&&n.call(g,i)&&(v=g);var y=m.prototype=h.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function o(r,i,a,l){var s=u(t[r],t,i);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==mt(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){o("next",t,a,l)}),(function(t){o("throw",t,a,l)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return o("throw",t,a,l)}))}l(s.arg)}var i;r(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,r){o(t,n,e,r)}))}return i=i?i.then(r,r):r()}})}function A(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var l=k(a,n);if(l){if(l===f)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=u(t,e,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}function k(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var o=u(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,f;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function B(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function N(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:O}}function O(){return{value:void 0,done:!0}}return p.prototype=m,r(y,"constructor",{value:m,configurable:!0}),r(m,"constructor",{value:p,configurable:!0}),p.displayName=s(m,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,s(t,l,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},w(b.prototype),s(b.prototype,a,(function(){return this})),t.AsyncIterator=b,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new b(c(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(y),s(y,l,"Generator"),s(y,i,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=N,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(l&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;x(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:N(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function dt(t,e,n,r,o,i,a){try{var l=t[i](a),s=l.value}catch(t){return void n(t)}l.done?e(s):Promise.resolve(s).then(r,o)}function gt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==mt(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==mt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===mt(o)?o:String(o)),r)}var o}function yt(t,e,n){return e&&gt(t.prototype,e),n&&gt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}new j(o);var wt=yt((function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.coordinate=e,this.x=n,this.y=r}));function bt(){var t;return t=vt().mark((function t(e){return vt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){var n=ft("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),r=new BABYLON.ShadowGenerator(2048,scene.lights[0]);r.usePercentageCloserFiltering=!0;var o=new BABYLON.AssetContainer(scene),i=[[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null]];U().then((function(e){for(var a=0;a<e.meshes.length;a++)if("Sword"==e.meshes[a].name)var l=e.meshes[a];else if("Scepter"==e.meshes[a].name)var s=e.meshes[a];else if("Shield"==e.meshes[a].name)var c=e.meshes[a];else if("Staff"==e.meshes[a].name)var u=e.meshes[a];else if("Spear"==e.meshes[a].name)var f=e.meshes[a];else if("Board"==e.meshes[a].name){var h=e.meshes[a].clone("Chessboard");h.receiveShadows=!0}else if("BoardDecoration"==e.meshes[a].name)e.meshes[a].clone("ChessboardDecoration").receiveShadows=!0;else if("PawnMesh"==e.meshes[a].name)var p=e.meshes[a],m=p.skeleton;else if("BishopMesh"==e.meshes[a].name)var v=e.meshes[a];else if("KnightMesh"==e.meshes[a].name)var d=e.meshes[a];else if("RookMesh"==e.meshes[a].name)var g=e.meshes[a];else if("QueenMesh"==e.meshes[a].name)var y=e.meshes[a];else if("KingMesh"==e.meshes[a].name)var w=e.meshes[a];for(var b=h.getBoundingInfo(),A=b.boundingBox.minimumWorld,k=b.boundingBox.maximumWorld,L=(k.x-A.x)/8,x=(k.z-A.z)/8,B=0;B<8;B++)for(var N=0;N<8;N++){var O=A.x+L/2+B*L,E=A.z+x/2+N*x,S=null;if(i[B][N]=[new BABYLON.Vector3(O,0,E),String.fromCharCode(97+N)+(8-B)],"p"==n[B][N].charAt(1)){(S=p.clone("Pawn")).skeleton=m.clone("Skeleton");var C=f.clone("newSpear"),T=S.skeleton.getBoneIndexByName("mixamorig:RightHandMiddle1");C.position.addInPlace(new BABYLON.Vector3(0,10,10)),C.attachToBone(S.skeleton.bones[T],S),C.scaling=new BABYLON.Vector3(80,80,80),C.rotationQuaternion=null,C.rotation.y=BABYLON.Tools.ToRadians(192),S.weapon=C}else if("n"==n[B][N].charAt(1)){(S=d.clone("Knight")).skeleton=d.skeleton.clone("KnightSkeleton");var _=l.clone("newSword");T=S.skeleton.getBoneIndexByName("mixamorig:RightHandMiddle1"),_.position.addInPlace(new BABYLON.Vector3(0,10,10)),_.attachToBone(S.skeleton.bones[T],S),_.scaling=new BABYLON.Vector3(80,80,80),_.rotationQuaternion=null,_.rotation.z=BABYLON.Tools.ToRadians(30),_.rotation.y=BABYLON.Tools.ToRadians(192),S.weapon=_}else if("b"==n[B][N].charAt(1)){(S=v.clone("Bishop")).skeleton=v.skeleton.clone("BishopSkeleton");var P=u.clone("newStaff");T=S.skeleton.getBoneIndexByName("mixamorig:RightHandMiddle1"),P.position.addInPlace(new BABYLON.Vector3(0,10,10)),P.attachToBone(S.skeleton.bones[T],S),P.scaling=new BABYLON.Vector3(80,80,80),P.rotationQuaternion=null,P.rotation.y=BABYLON.Tools.ToRadians(192),S.weapon=P}else if("r"==n[B][N].charAt(1)){(S=g.clone("Rook")).skeleton=g.skeleton.clone("RookSkeleton");var I=c.clone("newShield");T=S.skeleton.getBoneIndexByName("mixamorig:RightHandMiddle1"),I.position.addInPlace(new BABYLON.Vector3(10,65,-20)),I.attachToBone(S.skeleton.bones[T],S),I.scaling=new BABYLON.Vector3(80,80,80),I.rotationQuaternion=null,I.rotation.x=BABYLON.Tools.ToRadians(95),I.rotation.y=BABYLON.Tools.ToRadians(192),S.weapon=I}else if("q"==n[B][N].charAt(1))(S=y.clone("Queen")).skeleton=y.skeleton.clone("QueenSkeleton");else if("k"==n[B][N].charAt(1)){(S=w.clone("King")).skeleton=w.skeleton.clone("KingSkeleton");var R=s.clone("newScepter");T=S.skeleton.getBoneIndexByName("mixamorig:RightHandMiddle1"),R.position.addInPlace(new BABYLON.Vector3(0,10,10)),R.attachToBone(S.skeleton.bones[T],S),R.scaling=new BABYLON.Vector3(80,80,80),R.rotationQuaternion=null,R.rotation.z=BABYLON.Tools.ToRadians(30),R.rotation.y=BABYLON.Tools.ToRadians(192),S.weapon=R}if(S){S.piece=n[B][N],r.addShadowCaster(S),S.skeleton.animationPropertiesOverride=new BABYLON.AnimationPropertiesOverride,S.skeleton.animationPropertiesOverride.enableBlending=!0,S.skeleton.animationPropertiesOverride.blendingSpeed=.075,S.skeleton.animationPropertiesOverride.loopMode=1;var M=S.skeleton.getAnimationRange("Idle");scene.beginAnimation(S.skeleton,M.from,M.to,!0,1);var Y=S.material.clone("BlackMaterial");Y.disableLighting=!0;var j=S.material.clone("WhiteMaterial");if("b"==n[B][N].charAt(0)){for(S.material=Y,I&&(I.material=I.material.clone("BlackShield")),a=0;a<S.material.subMaterials.length;a++)"Metal"==S.material.subMaterials[a].name||"WhiteCloth"==S.material.subMaterials[a].name?(Y.subMaterials[a]=Y.subMaterials[a].clone("Black"),Y.subMaterials[a].albedoColor=new BABYLON.Color3(.1,.1,.1),I&&(I.material.subMaterials[0]=Y.subMaterials[a])):"Metal2"==S.material.subMaterials[a].name&&(Y.subMaterials[a]=Y.subMaterials[a].clone("Silver"),Y.subMaterials[a].albedoColor=new BABYLON.Color3(.8,.8,.9),I&&(I.material.subMaterials[1]=Y.subMaterials[a]),P&&(P.material=Y.subMaterials[a]),R&&(R.material=Y.subMaterials[a]));S.rotation.y-=BABYLON.Tools.ToRadians(90)}else"w"==n[B][N].charAt(0)&&(S.material=j,S.rotation.y+=BABYLON.Tools.ToRadians(90));S.name=n[B][N];var G=new wt(String.fromCharCode(97+N)+(8-B),N,B),D=new BABYLON.TransformNode("parentNode",scene);S.setParent(D,!0),D.position=new BABYLON.Vector3(O,0,E),S.piecePosition=G,o.meshes.push(S)}}t([o,i])}))})));case 1:case"end":return t.stop()}}),t)})),bt=function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){dt(i,r,o,a,l,"next",t)}function l(t){dt(i,r,o,a,l,"throw",t)}a(void 0)}))},bt.apply(this,arguments)}var At=new j(o),kt=null,Lt=null;(function(){return r.apply(this,arguments)})().then((function(t){(function(t){return bt.apply(this,arguments)})(At).then((function(e){H=At,setInterval(pt,100),function(t,e){console.log(t),Z=t,J=e,console.log("Coord pos:"+J);var n=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"),r=new BABYLON.GUI.StackPanel("buttonStackPanel");r.width="100%",r.height="50px",r.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,r.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM,r.isVertical=!1;var o=new BABYLON.GUI.TextBlock("movesLabel");o.width="100%",o.height="50px",o.color="white",o.text="Moves: 0/"+H.history.moves.length;var i=BABYLON.GUI.Button.CreateSimpleButton("leftButton","<");i.width="50%",i.height="50px",i.color="grey",i.background="white",i.paddingRight="10px",i.onPointerDownObservable.add((function(){W-=W>-1?1:0,o.text="Moves: "+(W+1)+"/"+H.history.moves.length})),r.addControl(i);var a=BABYLON.GUI.Button.CreateSimpleButton("rightButton",">");a.width="50%",a.height="50px",a.color="grey",a.background="white",a.paddingLeft="10px",a.onPointerDownObservable.add((function(){W+=W<H.history.moves.length-1?1:0,o.text="Moves: "+(W+1)+"/"+H.history.moves.length})),r.addControl(a);var l=new BABYLON.GUI.StackPanel("inputStackPanel");l.width="100%",l.height="60px",l.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,l.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;var s=new BABYLON.GUI.InputText("pgnInput");s.width="100%",s.height="50px",s.color="grey",s.background="white",s.autoStretchWidth=!1,s.placeholderText="Please paste a PGN here",s.placeholderColor="grey",s.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,s.onTextChangedObservable.add((function(t){})),s.onTextPasteObservable.add((function(t){!function(t){console.log("Setting PGN"),H=new j(t),et(-1)}(s.text)})),l.addControl(s);var c=new BABYLON.GUI.StackPanel("sliderStackPanel");c.width="100%",c.height="100px",c.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,c.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;var u=new BABYLON.GUI.TextBlock("sliderLabel");u.width="100%",u.height="50px",u.color="white",u.text="Move Speed (1s)",c.addControl(u);var f=new BABYLON.GUI.Slider("moveSpeedSlider");f.width="100%",f.height="50px",f.minimum=.5,f.maximum=3,f.color="white",f.value=tt,f.onValueChangedObservable.add((function(t){tt=t,u.text="Move Speed ("+t.toFixed(1)+"s)"})),c.addControl(f);var h=new BABYLON.GUI.StackPanel("mainStackPanel");h.width="20%",h.height="300px",h.paddingTop="10px",h.paddingRight="10px",h.horizontalAlignment=BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT,h.verticalAlignment=BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,h.isVertical=!0,n.addControl(h),h.addControl(l),h.addControl(c),h.addControl(o),h.addControl(r),scene.onKeyboardObservable.add((function(t){if(t.type===BABYLON.KeyboardEventTypes.KEYUP)switch(t.event.key){case"[":W-=W>-1?1:0,o.text="Moves:"+W+"/"+H.history.moves.length;break;case"]":W+=W<H.history.moves.length-1?1:0,o.text="Moves:"+W+"/"+H.history.moves.length;break;case"Enter":case"return":null!=s.text&&s.text}}))}(e[0],e[1]),kt=t[0],Lt=t[1],window.addEventListener("resize",(function(){kt.resize()})),kt.runRenderLoop((function(){Lt.render()})),BABYLON.Inspector.Show(Lt,{})}))}))})();